{"ast":null,"code":"/*!\n * serve-static\n * Copyright(c) 2010 Sencha Inc.\n * Copyright(c) 2011 TJ Holowaychuk\n * Copyright(c) 2014-2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\nvar encodeUrl = require('encodeurl');\nvar escapeHtml = require('escape-html');\nvar parseUrl = require('parseurl');\nvar resolve = require('path').resolve;\nvar send = require('send');\nvar url = require('url');\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = serveStatic;\nmodule.exports.mime = send.mime;\n\n/**\n * @param {string} root\n * @param {object} [options]\n * @return {function}\n * @public\n */\n\nfunction serveStatic(root, options) {\n  if (!root) {\n    throw new TypeError('root path required');\n  }\n  if (typeof root !== 'string') {\n    throw new TypeError('root path must be a string');\n  }\n\n  // copy options object\n  var opts = Object.create(options || null);\n\n  // fall-though\n  var fallthrough = opts.fallthrough !== false;\n\n  // default redirect\n  var redirect = opts.redirect !== false;\n\n  // headers listener\n  var setHeaders = opts.setHeaders;\n  if (setHeaders && typeof setHeaders !== 'function') {\n    throw new TypeError('option setHeaders must be function');\n  }\n\n  // setup options for send\n  opts.maxage = opts.maxage || opts.maxAge || 0;\n  opts.root = resolve(root);\n\n  // construct directory listener\n  var onDirectory = redirect ? createRedirectDirectoryListener() : createNotFoundDirectoryListener();\n  return function serveStatic(req, res, next) {\n    if (req.method !== 'GET' && req.method !== 'HEAD') {\n      if (fallthrough) {\n        return next();\n      }\n\n      // method not allowed\n      res.statusCode = 405;\n      res.setHeader('Allow', 'GET, HEAD');\n      res.setHeader('Content-Length', '0');\n      res.end();\n      return;\n    }\n    var forwardError = !fallthrough;\n    var originalUrl = parseUrl.original(req);\n    var path = parseUrl(req).pathname;\n\n    // make sure redirect occurs at mount\n    if (path === '/' && originalUrl.pathname.substr(-1) !== '/') {\n      path = '';\n    }\n\n    // create send stream\n    var stream = send(req, path, opts);\n\n    // add directory handler\n    stream.on('directory', onDirectory);\n\n    // add headers listener\n    if (setHeaders) {\n      stream.on('headers', setHeaders);\n    }\n\n    // add file listener for fallthrough\n    if (fallthrough) {\n      stream.on('file', function onFile() {\n        // once file is determined, always forward error\n        forwardError = true;\n      });\n    }\n\n    // forward errors\n    stream.on('error', function error(err) {\n      if (forwardError || !(err.statusCode < 500)) {\n        next(err);\n        return;\n      }\n      next();\n    });\n\n    // pipe\n    stream.pipe(res);\n  };\n}\n\n/**\n * Collapse all leading slashes into a single slash\n * @private\n */\nfunction collapseLeadingSlashes(str) {\n  for (var i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) !== 0x2f /* / */) {\n      break;\n    }\n  }\n  return i > 1 ? '/' + str.substr(i) : str;\n}\n\n/**\n * Create a minimal HTML document.\n *\n * @param {string} title\n * @param {string} body\n * @private\n */\n\nfunction createHtmlDocument(title, body) {\n  return '<!DOCTYPE html>\\n' + '<html lang=\"en\">\\n' + '<head>\\n' + '<meta charset=\"utf-8\">\\n' + '<title>' + title + '</title>\\n' + '</head>\\n' + '<body>\\n' + '<pre>' + body + '</pre>\\n' + '</body>\\n' + '</html>\\n';\n}\n\n/**\n * Create a directory listener that just 404s.\n * @private\n */\n\nfunction createNotFoundDirectoryListener() {\n  return function notFound() {\n    this.error(404);\n  };\n}\n\n/**\n * Create a directory listener that performs a redirect.\n * @private\n */\n\nfunction createRedirectDirectoryListener() {\n  return function redirect(res) {\n    if (this.hasTrailingSlash()) {\n      this.error(404);\n      return;\n    }\n\n    // get original URL\n    var originalUrl = parseUrl.original(this.req);\n\n    // append trailing slash\n    originalUrl.path = null;\n    originalUrl.pathname = collapseLeadingSlashes(originalUrl.pathname + '/');\n\n    // reformat the URL\n    var loc = encodeUrl(url.format(originalUrl));\n    var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' + escapeHtml(loc) + '</a>');\n\n    // send redirect response\n    res.statusCode = 301;\n    res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n    res.setHeader('Content-Length', Buffer.byteLength(doc));\n    res.setHeader('Content-Security-Policy', \"default-src 'none'\");\n    res.setHeader('X-Content-Type-Options', 'nosniff');\n    res.setHeader('Location', loc);\n    res.end(doc);\n  };\n}","map":{"version":3,"names":["encodeUrl","require","escapeHtml","parseUrl","resolve","send","url","module","exports","serveStatic","mime","root","options","TypeError","opts","Object","create","fallthrough","redirect","setHeaders","maxage","maxAge","onDirectory","createRedirectDirectoryListener","createNotFoundDirectoryListener","req","res","next","method","statusCode","setHeader","end","forwardError","originalUrl","original","path","pathname","substr","stream","on","onFile","error","err","pipe","collapseLeadingSlashes","str","i","length","charCodeAt","createHtmlDocument","title","body","notFound","hasTrailingSlash","loc","format","doc","Buffer","byteLength"],"sources":["/Users/jiangzilong/学习/minpg/Heptabase-Blog/node_modules/serve-static/index.js"],"sourcesContent":["/*!\n * serve-static\n * Copyright(c) 2010 Sencha Inc.\n * Copyright(c) 2011 TJ Holowaychuk\n * Copyright(c) 2014-2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar encodeUrl = require('encodeurl')\nvar escapeHtml = require('escape-html')\nvar parseUrl = require('parseurl')\nvar resolve = require('path').resolve\nvar send = require('send')\nvar url = require('url')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = serveStatic\nmodule.exports.mime = send.mime\n\n/**\n * @param {string} root\n * @param {object} [options]\n * @return {function}\n * @public\n */\n\nfunction serveStatic (root, options) {\n  if (!root) {\n    throw new TypeError('root path required')\n  }\n\n  if (typeof root !== 'string') {\n    throw new TypeError('root path must be a string')\n  }\n\n  // copy options object\n  var opts = Object.create(options || null)\n\n  // fall-though\n  var fallthrough = opts.fallthrough !== false\n\n  // default redirect\n  var redirect = opts.redirect !== false\n\n  // headers listener\n  var setHeaders = opts.setHeaders\n\n  if (setHeaders && typeof setHeaders !== 'function') {\n    throw new TypeError('option setHeaders must be function')\n  }\n\n  // setup options for send\n  opts.maxage = opts.maxage || opts.maxAge || 0\n  opts.root = resolve(root)\n\n  // construct directory listener\n  var onDirectory = redirect\n    ? createRedirectDirectoryListener()\n    : createNotFoundDirectoryListener()\n\n  return function serveStatic (req, res, next) {\n    if (req.method !== 'GET' && req.method !== 'HEAD') {\n      if (fallthrough) {\n        return next()\n      }\n\n      // method not allowed\n      res.statusCode = 405\n      res.setHeader('Allow', 'GET, HEAD')\n      res.setHeader('Content-Length', '0')\n      res.end()\n      return\n    }\n\n    var forwardError = !fallthrough\n    var originalUrl = parseUrl.original(req)\n    var path = parseUrl(req).pathname\n\n    // make sure redirect occurs at mount\n    if (path === '/' && originalUrl.pathname.substr(-1) !== '/') {\n      path = ''\n    }\n\n    // create send stream\n    var stream = send(req, path, opts)\n\n    // add directory handler\n    stream.on('directory', onDirectory)\n\n    // add headers listener\n    if (setHeaders) {\n      stream.on('headers', setHeaders)\n    }\n\n    // add file listener for fallthrough\n    if (fallthrough) {\n      stream.on('file', function onFile () {\n        // once file is determined, always forward error\n        forwardError = true\n      })\n    }\n\n    // forward errors\n    stream.on('error', function error (err) {\n      if (forwardError || !(err.statusCode < 500)) {\n        next(err)\n        return\n      }\n\n      next()\n    })\n\n    // pipe\n    stream.pipe(res)\n  }\n}\n\n/**\n * Collapse all leading slashes into a single slash\n * @private\n */\nfunction collapseLeadingSlashes (str) {\n  for (var i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) !== 0x2f /* / */) {\n      break\n    }\n  }\n\n  return i > 1\n    ? '/' + str.substr(i)\n    : str\n}\n\n/**\n * Create a minimal HTML document.\n *\n * @param {string} title\n * @param {string} body\n * @private\n */\n\nfunction createHtmlDocument (title, body) {\n  return '<!DOCTYPE html>\\n' +\n    '<html lang=\"en\">\\n' +\n    '<head>\\n' +\n    '<meta charset=\"utf-8\">\\n' +\n    '<title>' + title + '</title>\\n' +\n    '</head>\\n' +\n    '<body>\\n' +\n    '<pre>' + body + '</pre>\\n' +\n    '</body>\\n' +\n    '</html>\\n'\n}\n\n/**\n * Create a directory listener that just 404s.\n * @private\n */\n\nfunction createNotFoundDirectoryListener () {\n  return function notFound () {\n    this.error(404)\n  }\n}\n\n/**\n * Create a directory listener that performs a redirect.\n * @private\n */\n\nfunction createRedirectDirectoryListener () {\n  return function redirect (res) {\n    if (this.hasTrailingSlash()) {\n      this.error(404)\n      return\n    }\n\n    // get original URL\n    var originalUrl = parseUrl.original(this.req)\n\n    // append trailing slash\n    originalUrl.path = null\n    originalUrl.pathname = collapseLeadingSlashes(originalUrl.pathname + '/')\n\n    // reformat the URL\n    var loc = encodeUrl(url.format(originalUrl))\n    var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\n      escapeHtml(loc) + '</a>')\n\n    // send redirect response\n    res.statusCode = 301\n    res.setHeader('Content-Type', 'text/html; charset=UTF-8')\n    res.setHeader('Content-Length', Buffer.byteLength(doc))\n    res.setHeader('Content-Security-Policy', \"default-src 'none'\")\n    res.setHeader('X-Content-Type-Options', 'nosniff')\n    res.setHeader('Location', loc)\n    res.end(doc)\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY;;AAEZ;AACA;AACA;AACA;AAEA,IAAIA,SAAS,GAAGC,OAAO,CAAC,WAAW,CAAC;AACpC,IAAIC,UAAU,GAAGD,OAAO,CAAC,aAAa,CAAC;AACvC,IAAIE,QAAQ,GAAGF,OAAO,CAAC,UAAU,CAAC;AAClC,IAAIG,OAAO,GAAGH,OAAO,CAAC,MAAM,CAAC,CAACG,OAAO;AACrC,IAAIC,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAC1B,IAAIK,GAAG,GAAGL,OAAO,CAAC,KAAK,CAAC;;AAExB;AACA;AACA;AACA;;AAEAM,MAAM,CAACC,OAAO,GAAGC,WAAW;AAC5BF,MAAM,CAACC,OAAO,CAACE,IAAI,GAAGL,IAAI,CAACK,IAAI;;AAE/B;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASD,WAAW,CAAEE,IAAI,EAAEC,OAAO,EAAE;EACnC,IAAI,CAACD,IAAI,EAAE;IACT,MAAM,IAAIE,SAAS,CAAC,oBAAoB,CAAC;EAC3C;EAEA,IAAI,OAAOF,IAAI,KAAK,QAAQ,EAAE;IAC5B,MAAM,IAAIE,SAAS,CAAC,4BAA4B,CAAC;EACnD;;EAEA;EACA,IAAIC,IAAI,GAAGC,MAAM,CAACC,MAAM,CAACJ,OAAO,IAAI,IAAI,CAAC;;EAEzC;EACA,IAAIK,WAAW,GAAGH,IAAI,CAACG,WAAW,KAAK,KAAK;;EAE5C;EACA,IAAIC,QAAQ,GAAGJ,IAAI,CAACI,QAAQ,KAAK,KAAK;;EAEtC;EACA,IAAIC,UAAU,GAAGL,IAAI,CAACK,UAAU;EAEhC,IAAIA,UAAU,IAAI,OAAOA,UAAU,KAAK,UAAU,EAAE;IAClD,MAAM,IAAIN,SAAS,CAAC,oCAAoC,CAAC;EAC3D;;EAEA;EACAC,IAAI,CAACM,MAAM,GAAGN,IAAI,CAACM,MAAM,IAAIN,IAAI,CAACO,MAAM,IAAI,CAAC;EAC7CP,IAAI,CAACH,IAAI,GAAGP,OAAO,CAACO,IAAI,CAAC;;EAEzB;EACA,IAAIW,WAAW,GAAGJ,QAAQ,GACtBK,+BAA+B,EAAE,GACjCC,+BAA+B,EAAE;EAErC,OAAO,SAASf,WAAW,CAAEgB,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;IAC3C,IAAIF,GAAG,CAACG,MAAM,KAAK,KAAK,IAAIH,GAAG,CAACG,MAAM,KAAK,MAAM,EAAE;MACjD,IAAIX,WAAW,EAAE;QACf,OAAOU,IAAI,EAAE;MACf;;MAEA;MACAD,GAAG,CAACG,UAAU,GAAG,GAAG;MACpBH,GAAG,CAACI,SAAS,CAAC,OAAO,EAAE,WAAW,CAAC;MACnCJ,GAAG,CAACI,SAAS,CAAC,gBAAgB,EAAE,GAAG,CAAC;MACpCJ,GAAG,CAACK,GAAG,EAAE;MACT;IACF;IAEA,IAAIC,YAAY,GAAG,CAACf,WAAW;IAC/B,IAAIgB,WAAW,GAAG9B,QAAQ,CAAC+B,QAAQ,CAACT,GAAG,CAAC;IACxC,IAAIU,IAAI,GAAGhC,QAAQ,CAACsB,GAAG,CAAC,CAACW,QAAQ;;IAEjC;IACA,IAAID,IAAI,KAAK,GAAG,IAAIF,WAAW,CAACG,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;MAC3DF,IAAI,GAAG,EAAE;IACX;;IAEA;IACA,IAAIG,MAAM,GAAGjC,IAAI,CAACoB,GAAG,EAAEU,IAAI,EAAErB,IAAI,CAAC;;IAElC;IACAwB,MAAM,CAACC,EAAE,CAAC,WAAW,EAAEjB,WAAW,CAAC;;IAEnC;IACA,IAAIH,UAAU,EAAE;MACdmB,MAAM,CAACC,EAAE,CAAC,SAAS,EAAEpB,UAAU,CAAC;IAClC;;IAEA;IACA,IAAIF,WAAW,EAAE;MACfqB,MAAM,CAACC,EAAE,CAAC,MAAM,EAAE,SAASC,MAAM,GAAI;QACnC;QACAR,YAAY,GAAG,IAAI;MACrB,CAAC,CAAC;IACJ;;IAEA;IACAM,MAAM,CAACC,EAAE,CAAC,OAAO,EAAE,SAASE,KAAK,CAAEC,GAAG,EAAE;MACtC,IAAIV,YAAY,IAAI,EAAEU,GAAG,CAACb,UAAU,GAAG,GAAG,CAAC,EAAE;QAC3CF,IAAI,CAACe,GAAG,CAAC;QACT;MACF;MAEAf,IAAI,EAAE;IACR,CAAC,CAAC;;IAEF;IACAW,MAAM,CAACK,IAAI,CAACjB,GAAG,CAAC;EAClB,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA,SAASkB,sBAAsB,CAAEC,GAAG,EAAE;EACpC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,GAAG,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;IACnC,IAAID,GAAG,CAACG,UAAU,CAACF,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS;MACtC;IACF;EACF;EAEA,OAAOA,CAAC,GAAG,CAAC,GACR,GAAG,GAAGD,GAAG,CAACR,MAAM,CAACS,CAAC,CAAC,GACnBD,GAAG;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASI,kBAAkB,CAAEC,KAAK,EAAEC,IAAI,EAAE;EACxC,OAAO,mBAAmB,GACxB,oBAAoB,GACpB,UAAU,GACV,0BAA0B,GAC1B,SAAS,GAAGD,KAAK,GAAG,YAAY,GAChC,WAAW,GACX,UAAU,GACV,OAAO,GAAGC,IAAI,GAAG,UAAU,GAC3B,WAAW,GACX,WAAW;AACf;;AAEA;AACA;AACA;AACA;;AAEA,SAAS3B,+BAA+B,GAAI;EAC1C,OAAO,SAAS4B,QAAQ,GAAI;IAC1B,IAAI,CAACX,KAAK,CAAC,GAAG,CAAC;EACjB,CAAC;AACH;;AAEA;AACA;AACA;AACA;;AAEA,SAASlB,+BAA+B,GAAI;EAC1C,OAAO,SAASL,QAAQ,CAAEQ,GAAG,EAAE;IAC7B,IAAI,IAAI,CAAC2B,gBAAgB,EAAE,EAAE;MAC3B,IAAI,CAACZ,KAAK,CAAC,GAAG,CAAC;MACf;IACF;;IAEA;IACA,IAAIR,WAAW,GAAG9B,QAAQ,CAAC+B,QAAQ,CAAC,IAAI,CAACT,GAAG,CAAC;;IAE7C;IACAQ,WAAW,CAACE,IAAI,GAAG,IAAI;IACvBF,WAAW,CAACG,QAAQ,GAAGQ,sBAAsB,CAACX,WAAW,CAACG,QAAQ,GAAG,GAAG,CAAC;;IAEzE;IACA,IAAIkB,GAAG,GAAGtD,SAAS,CAACM,GAAG,CAACiD,MAAM,CAACtB,WAAW,CAAC,CAAC;IAC5C,IAAIuB,GAAG,GAAGP,kBAAkB,CAAC,aAAa,EAAE,0BAA0B,GAAG/C,UAAU,CAACoD,GAAG,CAAC,GAAG,IAAI,GAC7FpD,UAAU,CAACoD,GAAG,CAAC,GAAG,MAAM,CAAC;;IAE3B;IACA5B,GAAG,CAACG,UAAU,GAAG,GAAG;IACpBH,GAAG,CAACI,SAAS,CAAC,cAAc,EAAE,0BAA0B,CAAC;IACzDJ,GAAG,CAACI,SAAS,CAAC,gBAAgB,EAAE2B,MAAM,CAACC,UAAU,CAACF,GAAG,CAAC,CAAC;IACvD9B,GAAG,CAACI,SAAS,CAAC,yBAAyB,EAAE,oBAAoB,CAAC;IAC9DJ,GAAG,CAACI,SAAS,CAAC,wBAAwB,EAAE,SAAS,CAAC;IAClDJ,GAAG,CAACI,SAAS,CAAC,UAAU,EAAEwB,GAAG,CAAC;IAC9B5B,GAAG,CAACK,GAAG,CAACyB,GAAG,CAAC;EACd,CAAC;AACH"},"metadata":{},"sourceType":"script","externalDependencies":[]}