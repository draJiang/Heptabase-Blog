{"ast":null,"code":"/*!\n * destroy\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2022 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\nvar EventEmitter = require('events').EventEmitter;\nvar ReadStream = require('fs').ReadStream;\nvar Stream = require('stream');\nvar Zlib = require('zlib');\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = destroy;\n\n/**\n * Destroy the given stream, and optionally suppress any future `error` events.\n *\n * @param {object} stream\n * @param {boolean} suppress\n * @public\n */\n\nfunction destroy(stream, suppress) {\n  if (isFsReadStream(stream)) {\n    destroyReadStream(stream);\n  } else if (isZlibStream(stream)) {\n    destroyZlibStream(stream);\n  } else if (hasDestroy(stream)) {\n    stream.destroy();\n  }\n  if (isEventEmitter(stream) && suppress) {\n    stream.removeAllListeners('error');\n    stream.addListener('error', noop);\n  }\n  return stream;\n}\n\n/**\n * Destroy a ReadStream.\n *\n * @param {object} stream\n * @private\n */\n\nfunction destroyReadStream(stream) {\n  stream.destroy();\n  if (typeof stream.close === 'function') {\n    // node.js core bug work-around\n    stream.on('open', onOpenClose);\n  }\n}\n\n/**\n * Close a Zlib stream.\n *\n * Zlib streams below Node.js 4.5.5 have a buggy implementation\n * of .close() when zlib encountered an error.\n *\n * @param {object} stream\n * @private\n */\n\nfunction closeZlibStream(stream) {\n  if (stream._hadError === true) {\n    var prop = stream._binding === null ? '_binding' : '_handle';\n    stream[prop] = {\n      close: function () {\n        this[prop] = null;\n      }\n    };\n  }\n  stream.close();\n}\n\n/**\n * Destroy a Zlib stream.\n *\n * Zlib streams don't have a destroy function in Node.js 6. On top of that\n * simply calling destroy on a zlib stream in Node.js 8+ will result in a\n * memory leak. So until that is fixed, we need to call both close AND destroy.\n *\n * PR to fix memory leak: https://github.com/nodejs/node/pull/23734\n *\n * In Node.js 6+8, it's important that destroy is called before close as the\n * stream would otherwise emit the error 'zlib binding closed'.\n *\n * @param {object} stream\n * @private\n */\n\nfunction destroyZlibStream(stream) {\n  if (typeof stream.destroy === 'function') {\n    // node.js core bug work-around\n    // istanbul ignore if: node.js 0.8\n    if (stream._binding) {\n      // node.js < 0.10.0\n      stream.destroy();\n      if (stream._processing) {\n        stream._needDrain = true;\n        stream.once('drain', onDrainClearBinding);\n      } else {\n        stream._binding.clear();\n      }\n    } else if (stream._destroy && stream._destroy !== Stream.Transform.prototype._destroy) {\n      // node.js >= 12, ^11.1.0, ^10.15.1\n      stream.destroy();\n    } else if (stream._destroy && typeof stream.close === 'function') {\n      // node.js 7, 8\n      stream.destroyed = true;\n      stream.close();\n    } else {\n      // fallback\n      // istanbul ignore next\n      stream.destroy();\n    }\n  } else if (typeof stream.close === 'function') {\n    // node.js < 8 fallback\n    closeZlibStream(stream);\n  }\n}\n\n/**\n * Determine if stream has destroy.\n * @private\n */\n\nfunction hasDestroy(stream) {\n  return stream instanceof Stream && typeof stream.destroy === 'function';\n}\n\n/**\n * Determine if val is EventEmitter.\n * @private\n */\n\nfunction isEventEmitter(val) {\n  return val instanceof EventEmitter;\n}\n\n/**\n * Determine if stream is fs.ReadStream stream.\n * @private\n */\n\nfunction isFsReadStream(stream) {\n  return stream instanceof ReadStream;\n}\n\n/**\n * Determine if stream is Zlib stream.\n * @private\n */\n\nfunction isZlibStream(stream) {\n  return stream instanceof Zlib.Gzip || stream instanceof Zlib.Gunzip || stream instanceof Zlib.Deflate || stream instanceof Zlib.DeflateRaw || stream instanceof Zlib.Inflate || stream instanceof Zlib.InflateRaw || stream instanceof Zlib.Unzip;\n}\n\n/**\n * No-op function.\n * @private\n */\n\nfunction noop() {}\n\n/**\n * On drain handler to clear binding.\n * @private\n */\n\n// istanbul ignore next: node.js 0.8\nfunction onDrainClearBinding() {\n  this._binding.clear();\n}\n\n/**\n * On open handler to close stream.\n * @private\n */\n\nfunction onOpenClose() {\n  if (typeof this.fd === 'number') {\n    // actually close down the fd\n    this.close();\n  }\n}","map":{"version":3,"names":["EventEmitter","require","ReadStream","Stream","Zlib","module","exports","destroy","stream","suppress","isFsReadStream","destroyReadStream","isZlibStream","destroyZlibStream","hasDestroy","isEventEmitter","removeAllListeners","addListener","noop","close","on","onOpenClose","closeZlibStream","_hadError","prop","_binding","_processing","_needDrain","once","onDrainClearBinding","clear","_destroy","Transform","prototype","destroyed","val","Gzip","Gunzip","Deflate","DeflateRaw","Inflate","InflateRaw","Unzip","fd"],"sources":["/Users/jiangzilong/学习/minpg/Heptabase-Blog/node_modules/destroy/index.js"],"sourcesContent":["/*!\n * destroy\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2022 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar EventEmitter = require('events').EventEmitter\nvar ReadStream = require('fs').ReadStream\nvar Stream = require('stream')\nvar Zlib = require('zlib')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = destroy\n\n/**\n * Destroy the given stream, and optionally suppress any future `error` events.\n *\n * @param {object} stream\n * @param {boolean} suppress\n * @public\n */\n\nfunction destroy (stream, suppress) {\n  if (isFsReadStream(stream)) {\n    destroyReadStream(stream)\n  } else if (isZlibStream(stream)) {\n    destroyZlibStream(stream)\n  } else if (hasDestroy(stream)) {\n    stream.destroy()\n  }\n\n  if (isEventEmitter(stream) && suppress) {\n    stream.removeAllListeners('error')\n    stream.addListener('error', noop)\n  }\n\n  return stream\n}\n\n/**\n * Destroy a ReadStream.\n *\n * @param {object} stream\n * @private\n */\n\nfunction destroyReadStream (stream) {\n  stream.destroy()\n\n  if (typeof stream.close === 'function') {\n    // node.js core bug work-around\n    stream.on('open', onOpenClose)\n  }\n}\n\n/**\n * Close a Zlib stream.\n *\n * Zlib streams below Node.js 4.5.5 have a buggy implementation\n * of .close() when zlib encountered an error.\n *\n * @param {object} stream\n * @private\n */\n\nfunction closeZlibStream (stream) {\n  if (stream._hadError === true) {\n    var prop = stream._binding === null\n      ? '_binding'\n      : '_handle'\n\n    stream[prop] = {\n      close: function () { this[prop] = null }\n    }\n  }\n\n  stream.close()\n}\n\n/**\n * Destroy a Zlib stream.\n *\n * Zlib streams don't have a destroy function in Node.js 6. On top of that\n * simply calling destroy on a zlib stream in Node.js 8+ will result in a\n * memory leak. So until that is fixed, we need to call both close AND destroy.\n *\n * PR to fix memory leak: https://github.com/nodejs/node/pull/23734\n *\n * In Node.js 6+8, it's important that destroy is called before close as the\n * stream would otherwise emit the error 'zlib binding closed'.\n *\n * @param {object} stream\n * @private\n */\n\nfunction destroyZlibStream (stream) {\n  if (typeof stream.destroy === 'function') {\n    // node.js core bug work-around\n    // istanbul ignore if: node.js 0.8\n    if (stream._binding) {\n      // node.js < 0.10.0\n      stream.destroy()\n      if (stream._processing) {\n        stream._needDrain = true\n        stream.once('drain', onDrainClearBinding)\n      } else {\n        stream._binding.clear()\n      }\n    } else if (stream._destroy && stream._destroy !== Stream.Transform.prototype._destroy) {\n      // node.js >= 12, ^11.1.0, ^10.15.1\n      stream.destroy()\n    } else if (stream._destroy && typeof stream.close === 'function') {\n      // node.js 7, 8\n      stream.destroyed = true\n      stream.close()\n    } else {\n      // fallback\n      // istanbul ignore next\n      stream.destroy()\n    }\n  } else if (typeof stream.close === 'function') {\n    // node.js < 8 fallback\n    closeZlibStream(stream)\n  }\n}\n\n/**\n * Determine if stream has destroy.\n * @private\n */\n\nfunction hasDestroy (stream) {\n  return stream instanceof Stream &&\n    typeof stream.destroy === 'function'\n}\n\n/**\n * Determine if val is EventEmitter.\n * @private\n */\n\nfunction isEventEmitter (val) {\n  return val instanceof EventEmitter\n}\n\n/**\n * Determine if stream is fs.ReadStream stream.\n * @private\n */\n\nfunction isFsReadStream (stream) {\n  return stream instanceof ReadStream\n}\n\n/**\n * Determine if stream is Zlib stream.\n * @private\n */\n\nfunction isZlibStream (stream) {\n  return stream instanceof Zlib.Gzip ||\n    stream instanceof Zlib.Gunzip ||\n    stream instanceof Zlib.Deflate ||\n    stream instanceof Zlib.DeflateRaw ||\n    stream instanceof Zlib.Inflate ||\n    stream instanceof Zlib.InflateRaw ||\n    stream instanceof Zlib.Unzip\n}\n\n/**\n * No-op function.\n * @private\n */\n\nfunction noop () {}\n\n/**\n * On drain handler to clear binding.\n * @private\n */\n\n// istanbul ignore next: node.js 0.8\nfunction onDrainClearBinding () {\n  this._binding.clear()\n}\n\n/**\n * On open handler to close stream.\n * @private\n */\n\nfunction onOpenClose () {\n  if (typeof this.fd === 'number') {\n    // actually close down the fd\n    this.close()\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}