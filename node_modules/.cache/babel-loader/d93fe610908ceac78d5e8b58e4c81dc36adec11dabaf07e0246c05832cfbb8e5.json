{"ast":null,"code":"'use strict';\n\nconst Tokenizer = require('../tokenizer');\nconst OpenElementStack = require('./open-element-stack');\nconst FormattingElementList = require('./formatting-element-list');\nconst LocationInfoParserMixin = require('../extensions/location-info/parser-mixin');\nconst ErrorReportingParserMixin = require('../extensions/error-reporting/parser-mixin');\nconst Mixin = require('../utils/mixin');\nconst defaultTreeAdapter = require('../tree-adapters/default');\nconst mergeOptions = require('../utils/merge-options');\nconst doctype = require('../common/doctype');\nconst foreignContent = require('../common/foreign-content');\nconst ERR = require('../common/error-codes');\nconst unicode = require('../common/unicode');\nconst HTML = require('../common/html');\n\n//Aliases\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\nconst ATTRS = HTML.ATTRS;\nconst DEFAULT_OPTIONS = {\n  scriptingEnabled: true,\n  sourceCodeLocationInfo: false,\n  onParseError: null,\n  treeAdapter: defaultTreeAdapter\n};\n\n//Misc constants\nconst HIDDEN_INPUT_TYPE = 'hidden';\n\n//Adoption agency loops iteration count\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3;\n\n//Insertion modes\nconst INITIAL_MODE = 'INITIAL_MODE';\nconst BEFORE_HTML_MODE = 'BEFORE_HTML_MODE';\nconst BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE';\nconst IN_HEAD_MODE = 'IN_HEAD_MODE';\nconst IN_HEAD_NO_SCRIPT_MODE = 'IN_HEAD_NO_SCRIPT_MODE';\nconst AFTER_HEAD_MODE = 'AFTER_HEAD_MODE';\nconst IN_BODY_MODE = 'IN_BODY_MODE';\nconst TEXT_MODE = 'TEXT_MODE';\nconst IN_TABLE_MODE = 'IN_TABLE_MODE';\nconst IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE';\nconst IN_CAPTION_MODE = 'IN_CAPTION_MODE';\nconst IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE';\nconst IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE';\nconst IN_ROW_MODE = 'IN_ROW_MODE';\nconst IN_CELL_MODE = 'IN_CELL_MODE';\nconst IN_SELECT_MODE = 'IN_SELECT_MODE';\nconst IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE';\nconst IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE';\nconst AFTER_BODY_MODE = 'AFTER_BODY_MODE';\nconst IN_FRAMESET_MODE = 'IN_FRAMESET_MODE';\nconst AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE';\nconst AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE';\nconst AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE';\n\n//Insertion mode reset map\nconst INSERTION_MODE_RESET_MAP = {\n  [$.TR]: IN_ROW_MODE,\n  [$.TBODY]: IN_TABLE_BODY_MODE,\n  [$.THEAD]: IN_TABLE_BODY_MODE,\n  [$.TFOOT]: IN_TABLE_BODY_MODE,\n  [$.CAPTION]: IN_CAPTION_MODE,\n  [$.COLGROUP]: IN_COLUMN_GROUP_MODE,\n  [$.TABLE]: IN_TABLE_MODE,\n  [$.BODY]: IN_BODY_MODE,\n  [$.FRAMESET]: IN_FRAMESET_MODE\n};\n\n//Template insertion mode switch map\nconst TEMPLATE_INSERTION_MODE_SWITCH_MAP = {\n  [$.CAPTION]: IN_TABLE_MODE,\n  [$.COLGROUP]: IN_TABLE_MODE,\n  [$.TBODY]: IN_TABLE_MODE,\n  [$.TFOOT]: IN_TABLE_MODE,\n  [$.THEAD]: IN_TABLE_MODE,\n  [$.COL]: IN_COLUMN_GROUP_MODE,\n  [$.TR]: IN_TABLE_BODY_MODE,\n  [$.TD]: IN_ROW_MODE,\n  [$.TH]: IN_ROW_MODE\n};\n\n//Token handlers map for insertion modes\nconst TOKEN_HANDLERS = {\n  [INITIAL_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenInInitialMode,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInInitialMode,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: doctypeInInitialMode,\n    [Tokenizer.START_TAG_TOKEN]: tokenInInitialMode,\n    [Tokenizer.END_TAG_TOKEN]: tokenInInitialMode,\n    [Tokenizer.EOF_TOKEN]: tokenInInitialMode\n  },\n  [BEFORE_HTML_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenBeforeHtml,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenBeforeHtml,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagBeforeHtml,\n    [Tokenizer.END_TAG_TOKEN]: endTagBeforeHtml,\n    [Tokenizer.EOF_TOKEN]: tokenBeforeHtml\n  },\n  [BEFORE_HEAD_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenBeforeHead,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenBeforeHead,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n    [Tokenizer.START_TAG_TOKEN]: startTagBeforeHead,\n    [Tokenizer.END_TAG_TOKEN]: endTagBeforeHead,\n    [Tokenizer.EOF_TOKEN]: tokenBeforeHead\n  },\n  [IN_HEAD_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenInHead,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInHead,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n    [Tokenizer.START_TAG_TOKEN]: startTagInHead,\n    [Tokenizer.END_TAG_TOKEN]: endTagInHead,\n    [Tokenizer.EOF_TOKEN]: tokenInHead\n  },\n  [IN_HEAD_NO_SCRIPT_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenInHeadNoScript,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInHeadNoScript,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n    [Tokenizer.START_TAG_TOKEN]: startTagInHeadNoScript,\n    [Tokenizer.END_TAG_TOKEN]: endTagInHeadNoScript,\n    [Tokenizer.EOF_TOKEN]: tokenInHeadNoScript\n  },\n  [AFTER_HEAD_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenAfterHead,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterHead,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n    [Tokenizer.START_TAG_TOKEN]: startTagAfterHead,\n    [Tokenizer.END_TAG_TOKEN]: endTagAfterHead,\n    [Tokenizer.EOF_TOKEN]: tokenAfterHead\n  },\n  [IN_BODY_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInBody,\n    [Tokenizer.END_TAG_TOKEN]: endTagInBody,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [TEXT_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: ignoreToken,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: ignoreToken,\n    [Tokenizer.END_TAG_TOKEN]: endTagInText,\n    [Tokenizer.EOF_TOKEN]: eofInText\n  },\n  [IN_TABLE_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInTable,\n    [Tokenizer.END_TAG_TOKEN]: endTagInTable,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_TABLE_TEXT_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInTableText,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInTableText,\n    [Tokenizer.COMMENT_TOKEN]: tokenInTableText,\n    [Tokenizer.DOCTYPE_TOKEN]: tokenInTableText,\n    [Tokenizer.START_TAG_TOKEN]: tokenInTableText,\n    [Tokenizer.END_TAG_TOKEN]: tokenInTableText,\n    [Tokenizer.EOF_TOKEN]: tokenInTableText\n  },\n  [IN_CAPTION_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInCaption,\n    [Tokenizer.END_TAG_TOKEN]: endTagInCaption,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_COLUMN_GROUP_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenInColumnGroup,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInColumnGroup,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInColumnGroup,\n    [Tokenizer.END_TAG_TOKEN]: endTagInColumnGroup,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_TABLE_BODY_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInTableBody,\n    [Tokenizer.END_TAG_TOKEN]: endTagInTableBody,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_ROW_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInRow,\n    [Tokenizer.END_TAG_TOKEN]: endTagInRow,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_CELL_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInCell,\n    [Tokenizer.END_TAG_TOKEN]: endTagInCell,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_SELECT_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInSelect,\n    [Tokenizer.END_TAG_TOKEN]: endTagInSelect,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_SELECT_IN_TABLE_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInSelectInTable,\n    [Tokenizer.END_TAG_TOKEN]: endTagInSelectInTable,\n    [Tokenizer.EOF_TOKEN]: eofInBody\n  },\n  [IN_TEMPLATE_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInTemplate,\n    [Tokenizer.END_TAG_TOKEN]: endTagInTemplate,\n    [Tokenizer.EOF_TOKEN]: eofInTemplate\n  },\n  [AFTER_BODY_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenAfterBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterBody,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendCommentToRootHtmlElement,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagAfterBody,\n    [Tokenizer.END_TAG_TOKEN]: endTagAfterBody,\n    [Tokenizer.EOF_TOKEN]: stopParsing\n  },\n  [IN_FRAMESET_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagInFrameset,\n    [Tokenizer.END_TAG_TOKEN]: endTagInFrameset,\n    [Tokenizer.EOF_TOKEN]: stopParsing\n  },\n  [AFTER_FRAMESET_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n    [Tokenizer.COMMENT_TOKEN]: appendComment,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagAfterFrameset,\n    [Tokenizer.END_TAG_TOKEN]: endTagAfterFrameset,\n    [Tokenizer.EOF_TOKEN]: stopParsing\n  },\n  [AFTER_AFTER_BODY_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: tokenAfterAfterBody,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterAfterBody,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendCommentToDocument,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagAfterAfterBody,\n    [Tokenizer.END_TAG_TOKEN]: tokenAfterAfterBody,\n    [Tokenizer.EOF_TOKEN]: stopParsing\n  },\n  [AFTER_AFTER_FRAMESET_MODE]: {\n    [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n    [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n    [Tokenizer.COMMENT_TOKEN]: appendCommentToDocument,\n    [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n    [Tokenizer.START_TAG_TOKEN]: startTagAfterAfterFrameset,\n    [Tokenizer.END_TAG_TOKEN]: ignoreToken,\n    [Tokenizer.EOF_TOKEN]: stopParsing\n  }\n};\n\n//Parser\nclass Parser {\n  constructor(options) {\n    this.options = mergeOptions(DEFAULT_OPTIONS, options);\n    this.treeAdapter = this.options.treeAdapter;\n    this.pendingScript = null;\n    if (this.options.sourceCodeLocationInfo) {\n      Mixin.install(this, LocationInfoParserMixin);\n    }\n    if (this.options.onParseError) {\n      Mixin.install(this, ErrorReportingParserMixin, {\n        onParseError: this.options.onParseError\n      });\n    }\n  }\n\n  // API\n  parse(html) {\n    const document = this.treeAdapter.createDocument();\n    this._bootstrap(document, null);\n    this.tokenizer.write(html, true);\n    this._runParsingLoop(null);\n    return document;\n  }\n  parseFragment(html, fragmentContext) {\n    //NOTE: use <template> element as a fragment context if context element was not provided,\n    //so we will parse in \"forgiving\" manner\n    if (!fragmentContext) {\n      fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []);\n    }\n\n    //NOTE: create fake element which will be used as 'document' for fragment parsing.\n    //This is important for jsdom there 'document' can't be recreated, therefore\n    //fragment parsing causes messing of the main `document`.\n    const documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\n    this._bootstrap(documentMock, fragmentContext);\n    if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE) {\n      this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n    }\n    this._initTokenizerForFragmentParsing();\n    this._insertFakeRootElement();\n    this._resetInsertionMode();\n    this._findFormInFragmentContext();\n    this.tokenizer.write(html, true);\n    this._runParsingLoop(null);\n    const rootElement = this.treeAdapter.getFirstChild(documentMock);\n    const fragment = this.treeAdapter.createDocumentFragment();\n    this._adoptNodes(rootElement, fragment);\n    return fragment;\n  }\n\n  //Bootstrap parser\n  _bootstrap(document, fragmentContext) {\n    this.tokenizer = new Tokenizer(this.options);\n    this.stopped = false;\n    this.insertionMode = INITIAL_MODE;\n    this.originalInsertionMode = '';\n    this.document = document;\n    this.fragmentContext = fragmentContext;\n    this.headElement = null;\n    this.formElement = null;\n    this.openElements = new OpenElementStack(this.document, this.treeAdapter);\n    this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n    this.tmplInsertionModeStack = [];\n    this.tmplInsertionModeStackTop = -1;\n    this.currentTmplInsertionMode = null;\n    this.pendingCharacterTokens = [];\n    this.hasNonWhitespacePendingCharacterToken = false;\n    this.framesetOk = true;\n    this.skipNextNewLine = false;\n    this.fosterParentingEnabled = false;\n  }\n\n  //Errors\n  _err() {\n    // NOTE: err reporting is noop by default. Enabled by mixin.\n  }\n\n  //Parsing loop\n  _runParsingLoop(scriptHandler) {\n    while (!this.stopped) {\n      this._setupTokenizerCDATAMode();\n      const token = this.tokenizer.getNextToken();\n      if (token.type === Tokenizer.HIBERNATION_TOKEN) {\n        break;\n      }\n      if (this.skipNextNewLine) {\n        this.skipNextNewLine = false;\n        if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\n          if (token.chars.length === 1) {\n            continue;\n          }\n          token.chars = token.chars.substr(1);\n        }\n      }\n      this._processInputToken(token);\n      if (scriptHandler && this.pendingScript) {\n        break;\n      }\n    }\n  }\n  runParsingLoopForCurrentChunk(writeCallback, scriptHandler) {\n    this._runParsingLoop(scriptHandler);\n    if (scriptHandler && this.pendingScript) {\n      const script = this.pendingScript;\n      this.pendingScript = null;\n      scriptHandler(script);\n      return;\n    }\n    if (writeCallback) {\n      writeCallback();\n    }\n  }\n\n  //Text parsing\n  _setupTokenizerCDATAMode() {\n    const current = this._getAdjustedCurrentElement();\n    this.tokenizer.allowCDATA = current && current !== this.document && this.treeAdapter.getNamespaceURI(current) !== NS.HTML && !this._isIntegrationPoint(current);\n  }\n  _switchToTextParsing(currentToken, nextTokenizerState) {\n    this._insertElement(currentToken, NS.HTML);\n    this.tokenizer.state = nextTokenizerState;\n    this.originalInsertionMode = this.insertionMode;\n    this.insertionMode = TEXT_MODE;\n  }\n  switchToPlaintextParsing() {\n    this.insertionMode = TEXT_MODE;\n    this.originalInsertionMode = IN_BODY_MODE;\n    this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n  }\n\n  //Fragment parsing\n  _getAdjustedCurrentElement() {\n    return this.openElements.stackTop === 0 && this.fragmentContext ? this.fragmentContext : this.openElements.current;\n  }\n  _findFormInFragmentContext() {\n    let node = this.fragmentContext;\n    do {\n      if (this.treeAdapter.getTagName(node) === $.FORM) {\n        this.formElement = node;\n        break;\n      }\n      node = this.treeAdapter.getParentNode(node);\n    } while (node);\n  }\n  _initTokenizerForFragmentParsing() {\n    if (this.treeAdapter.getNamespaceURI(this.fragmentContext) === NS.HTML) {\n      const tn = this.treeAdapter.getTagName(this.fragmentContext);\n      if (tn === $.TITLE || tn === $.TEXTAREA) {\n        this.tokenizer.state = Tokenizer.MODE.RCDATA;\n      } else if (tn === $.STYLE || tn === $.XMP || tn === $.IFRAME || tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT) {\n        this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\n      } else if (tn === $.SCRIPT) {\n        this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;\n      } else if (tn === $.PLAINTEXT) {\n        this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n      }\n    }\n  }\n\n  //Tree mutation\n  _setDocumentType(token) {\n    const name = token.name || '';\n    const publicId = token.publicId || '';\n    const systemId = token.systemId || '';\n    this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n  }\n  _attachElementToTree(element) {\n    if (this._shouldFosterParentOnInsertion()) {\n      this._fosterParentElement(element);\n    } else {\n      const parent = this.openElements.currentTmplContent || this.openElements.current;\n      this.treeAdapter.appendChild(parent, element);\n    }\n  }\n  _appendElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n    this._attachElementToTree(element);\n  }\n  _insertElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n    this._attachElementToTree(element);\n    this.openElements.push(element);\n  }\n  _insertFakeElement(tagName) {\n    const element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n    this._attachElementToTree(element);\n    this.openElements.push(element);\n  }\n  _insertTemplate(token) {\n    const tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs);\n    const content = this.treeAdapter.createDocumentFragment();\n    this.treeAdapter.setTemplateContent(tmpl, content);\n    this._attachElementToTree(tmpl);\n    this.openElements.push(tmpl);\n  }\n  _insertFakeRootElement() {\n    const element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\n    this.treeAdapter.appendChild(this.openElements.current, element);\n    this.openElements.push(element);\n  }\n  _appendCommentNode(token, parent) {\n    const commentNode = this.treeAdapter.createCommentNode(token.data);\n    this.treeAdapter.appendChild(parent, commentNode);\n  }\n  _insertCharacters(token) {\n    if (this._shouldFosterParentOnInsertion()) {\n      this._fosterParentText(token.chars);\n    } else {\n      const parent = this.openElements.currentTmplContent || this.openElements.current;\n      this.treeAdapter.insertText(parent, token.chars);\n    }\n  }\n  _adoptNodes(donor, recipient) {\n    for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n      this.treeAdapter.detachNode(child);\n      this.treeAdapter.appendChild(recipient, child);\n    }\n  }\n\n  //Token processing\n  _shouldProcessTokenInForeignContent(token) {\n    const current = this._getAdjustedCurrentElement();\n    if (!current || current === this.document) {\n      return false;\n    }\n    const ns = this.treeAdapter.getNamespaceURI(current);\n    if (ns === NS.HTML) {\n      return false;\n    }\n    if (this.treeAdapter.getTagName(current) === $.ANNOTATION_XML && ns === NS.MATHML && token.type === Tokenizer.START_TAG_TOKEN && token.tagName === $.SVG) {\n      return false;\n    }\n    const isCharacterToken = token.type === Tokenizer.CHARACTER_TOKEN || token.type === Tokenizer.NULL_CHARACTER_TOKEN || token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN;\n    const isMathMLTextStartTag = token.type === Tokenizer.START_TAG_TOKEN && token.tagName !== $.MGLYPH && token.tagName !== $.MALIGNMARK;\n    if ((isMathMLTextStartTag || isCharacterToken) && this._isIntegrationPoint(current, NS.MATHML)) {\n      return false;\n    }\n    if ((token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) && this._isIntegrationPoint(current, NS.HTML)) {\n      return false;\n    }\n    return token.type !== Tokenizer.EOF_TOKEN;\n  }\n  _processToken(token) {\n    TOKEN_HANDLERS[this.insertionMode][token.type](this, token);\n  }\n  _processTokenInBodyMode(token) {\n    TOKEN_HANDLERS[IN_BODY_MODE][token.type](this, token);\n  }\n  _processTokenInForeignContent(token) {\n    if (token.type === Tokenizer.CHARACTER_TOKEN) {\n      characterInForeignContent(this, token);\n    } else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN) {\n      nullCharacterInForeignContent(this, token);\n    } else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN) {\n      insertCharacters(this, token);\n    } else if (token.type === Tokenizer.COMMENT_TOKEN) {\n      appendComment(this, token);\n    } else if (token.type === Tokenizer.START_TAG_TOKEN) {\n      startTagInForeignContent(this, token);\n    } else if (token.type === Tokenizer.END_TAG_TOKEN) {\n      endTagInForeignContent(this, token);\n    }\n  }\n  _processInputToken(token) {\n    if (this._shouldProcessTokenInForeignContent(token)) {\n      this._processTokenInForeignContent(token);\n    } else {\n      this._processToken(token);\n    }\n    if (token.type === Tokenizer.START_TAG_TOKEN && token.selfClosing && !token.ackSelfClosing) {\n      this._err(ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n    }\n  }\n\n  //Integration points\n  _isIntegrationPoint(element, foreignNS) {\n    const tn = this.treeAdapter.getTagName(element);\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    const attrs = this.treeAdapter.getAttrList(element);\n    return foreignContent.isIntegrationPoint(tn, ns, attrs, foreignNS);\n  }\n\n  //Active formatting elements reconstruction\n  _reconstructActiveFormattingElements() {\n    const listLength = this.activeFormattingElements.length;\n    if (listLength) {\n      let unopenIdx = listLength;\n      let entry = null;\n      do {\n        unopenIdx--;\n        entry = this.activeFormattingElements.entries[unopenIdx];\n        if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\n          unopenIdx++;\n          break;\n        }\n      } while (unopenIdx > 0);\n      for (let i = unopenIdx; i < listLength; i++) {\n        entry = this.activeFormattingElements.entries[i];\n        this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n        entry.element = this.openElements.current;\n      }\n    }\n  }\n\n  //Close elements\n  _closeTableCell() {\n    this.openElements.generateImpliedEndTags();\n    this.openElements.popUntilTableCellPopped();\n    this.activeFormattingElements.clearToLastMarker();\n    this.insertionMode = IN_ROW_MODE;\n  }\n  _closePElement() {\n    this.openElements.generateImpliedEndTagsWithExclusion($.P);\n    this.openElements.popUntilTagNamePopped($.P);\n  }\n\n  //Insertion modes\n  _resetInsertionMode() {\n    for (let i = this.openElements.stackTop, last = false; i >= 0; i--) {\n      let element = this.openElements.items[i];\n      if (i === 0) {\n        last = true;\n        if (this.fragmentContext) {\n          element = this.fragmentContext;\n        }\n      }\n      const tn = this.treeAdapter.getTagName(element);\n      const newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\n      if (newInsertionMode) {\n        this.insertionMode = newInsertionMode;\n        break;\n      } else if (!last && (tn === $.TD || tn === $.TH)) {\n        this.insertionMode = IN_CELL_MODE;\n        break;\n      } else if (!last && tn === $.HEAD) {\n        this.insertionMode = IN_HEAD_MODE;\n        break;\n      } else if (tn === $.SELECT) {\n        this._resetInsertionModeForSelect(i);\n        break;\n      } else if (tn === $.TEMPLATE) {\n        this.insertionMode = this.currentTmplInsertionMode;\n        break;\n      } else if (tn === $.HTML) {\n        this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\n        break;\n      } else if (last) {\n        this.insertionMode = IN_BODY_MODE;\n        break;\n      }\n    }\n  }\n  _resetInsertionModeForSelect(selectIdx) {\n    if (selectIdx > 0) {\n      for (let i = selectIdx - 1; i > 0; i--) {\n        const ancestor = this.openElements.items[i];\n        const tn = this.treeAdapter.getTagName(ancestor);\n        if (tn === $.TEMPLATE) {\n          break;\n        } else if (tn === $.TABLE) {\n          this.insertionMode = IN_SELECT_IN_TABLE_MODE;\n          return;\n        }\n      }\n    }\n    this.insertionMode = IN_SELECT_MODE;\n  }\n  _pushTmplInsertionMode(mode) {\n    this.tmplInsertionModeStack.push(mode);\n    this.tmplInsertionModeStackTop++;\n    this.currentTmplInsertionMode = mode;\n  }\n  _popTmplInsertionMode() {\n    this.tmplInsertionModeStack.pop();\n    this.tmplInsertionModeStackTop--;\n    this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\n  }\n\n  //Foster parenting\n  _isElementCausesFosterParenting(element) {\n    const tn = this.treeAdapter.getTagName(element);\n    return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR;\n  }\n  _shouldFosterParentOnInsertion() {\n    return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\n  }\n  _findFosterParentingLocation() {\n    const location = {\n      parent: null,\n      beforeElement: null\n    };\n    for (let i = this.openElements.stackTop; i >= 0; i--) {\n      const openElement = this.openElements.items[i];\n      const tn = this.treeAdapter.getTagName(openElement);\n      const ns = this.treeAdapter.getNamespaceURI(openElement);\n      if (tn === $.TEMPLATE && ns === NS.HTML) {\n        location.parent = this.treeAdapter.getTemplateContent(openElement);\n        break;\n      } else if (tn === $.TABLE) {\n        location.parent = this.treeAdapter.getParentNode(openElement);\n        if (location.parent) {\n          location.beforeElement = openElement;\n        } else {\n          location.parent = this.openElements.items[i - 1];\n        }\n        break;\n      }\n    }\n    if (!location.parent) {\n      location.parent = this.openElements.items[0];\n    }\n    return location;\n  }\n  _fosterParentElement(element) {\n    const location = this._findFosterParentingLocation();\n    if (location.beforeElement) {\n      this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n    } else {\n      this.treeAdapter.appendChild(location.parent, element);\n    }\n  }\n  _fosterParentText(chars) {\n    const location = this._findFosterParentingLocation();\n    if (location.beforeElement) {\n      this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);\n    } else {\n      this.treeAdapter.insertText(location.parent, chars);\n    }\n  }\n\n  //Special elements\n  _isSpecialElement(element) {\n    const tn = this.treeAdapter.getTagName(element);\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    return HTML.SPECIAL_ELEMENTS[ns][tn];\n  }\n}\nmodule.exports = Parser;\n\n//Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n\n//Steps 5-8 of the algorithm\nfunction aaObtainFormattingElementEntry(p, token) {\n  let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n  if (formattingElementEntry) {\n    if (!p.openElements.contains(formattingElementEntry.element)) {\n      p.activeFormattingElements.removeEntry(formattingElementEntry);\n      formattingElementEntry = null;\n    } else if (!p.openElements.hasInScope(token.tagName)) {\n      formattingElementEntry = null;\n    }\n  } else {\n    genericEndTagInBody(p, token);\n  }\n  return formattingElementEntry;\n}\n\n//Steps 9 and 10 of the algorithm\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n  let furthestBlock = null;\n  for (let i = p.openElements.stackTop; i >= 0; i--) {\n    const element = p.openElements.items[i];\n    if (element === formattingElementEntry.element) {\n      break;\n    }\n    if (p._isSpecialElement(element)) {\n      furthestBlock = element;\n    }\n  }\n  if (!furthestBlock) {\n    p.openElements.popUntilElementPopped(formattingElementEntry.element);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n  }\n  return furthestBlock;\n}\n\n//Step 13 of the algorithm\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n  let lastElement = furthestBlock;\n  let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n  for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n    //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n    nextElement = p.openElements.getCommonAncestor(element);\n    const elementEntry = p.activeFormattingElements.getElementEntry(element);\n    const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n    const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n    if (shouldRemoveFromOpenElements) {\n      if (counterOverflow) {\n        p.activeFormattingElements.removeEntry(elementEntry);\n      }\n      p.openElements.remove(element);\n    } else {\n      element = aaRecreateElementFromEntry(p, elementEntry);\n      if (lastElement === furthestBlock) {\n        p.activeFormattingElements.bookmark = elementEntry;\n      }\n      p.treeAdapter.detachNode(lastElement);\n      p.treeAdapter.appendChild(element, lastElement);\n      lastElement = element;\n    }\n  }\n  return lastElement;\n}\n\n//Step 13.7 of the algorithm\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n  const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n  p.openElements.replace(elementEntry.element, newElement);\n  elementEntry.element = newElement;\n  return newElement;\n}\n\n//Step 14 of the algorithm\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n  if (p._isElementCausesFosterParenting(commonAncestor)) {\n    p._fosterParentElement(lastElement);\n  } else {\n    const tn = p.treeAdapter.getTagName(commonAncestor);\n    const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n    if (tn === $.TEMPLATE && ns === NS.HTML) {\n      commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n    }\n    p.treeAdapter.appendChild(commonAncestor, lastElement);\n  }\n}\n\n//Steps 15-19 of the algorithm\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n  const token = formattingElementEntry.token;\n  const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n  p._adoptNodes(furthestBlock, newElement);\n  p.treeAdapter.appendChild(furthestBlock, newElement);\n  p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\n  p.activeFormattingElements.removeEntry(formattingElementEntry);\n  p.openElements.remove(formattingElementEntry.element);\n  p.openElements.insertAfter(furthestBlock, newElement);\n}\n\n//Algorithm entry point\nfunction callAdoptionAgency(p, token) {\n  let formattingElementEntry;\n  for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n    formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\n    if (!formattingElementEntry) {\n      break;\n    }\n    const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n    if (!furthestBlock) {\n      break;\n    }\n    p.activeFormattingElements.bookmark = formattingElementEntry;\n    const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n    const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n    p.treeAdapter.detachNode(lastElement);\n    aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n    aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n  }\n}\n\n//Generic token handlers\n//------------------------------------------------------------------\nfunction ignoreToken() {\n  //NOTE: do nothing =)\n}\nfunction misplacedDoctype(p) {\n  p._err(ERR.misplacedDoctype);\n}\nfunction appendComment(p, token) {\n  p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current);\n}\nfunction appendCommentToRootHtmlElement(p, token) {\n  p._appendCommentNode(token, p.openElements.items[0]);\n}\nfunction appendCommentToDocument(p, token) {\n  p._appendCommentNode(token, p.document);\n}\nfunction insertCharacters(p, token) {\n  p._insertCharacters(token);\n}\nfunction stopParsing(p) {\n  p.stopped = true;\n}\n\n// The \"initial\" insertion mode\n//------------------------------------------------------------------\nfunction doctypeInInitialMode(p, token) {\n  p._setDocumentType(token);\n  const mode = token.forceQuirks ? HTML.DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n  if (!doctype.isConforming(token)) {\n    p._err(ERR.nonConformingDoctype);\n  }\n  p.treeAdapter.setDocumentMode(p.document, mode);\n  p.insertionMode = BEFORE_HTML_MODE;\n}\nfunction tokenInInitialMode(p, token) {\n  p._err(ERR.missingDoctype, {\n    beforeToken: true\n  });\n  p.treeAdapter.setDocumentMode(p.document, HTML.DOCUMENT_MODE.QUIRKS);\n  p.insertionMode = BEFORE_HTML_MODE;\n  p._processToken(token);\n}\n\n// The \"before html\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHtml(p, token) {\n  if (token.tagName === $.HTML) {\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = BEFORE_HEAD_MODE;\n  } else {\n    tokenBeforeHtml(p, token);\n  }\n}\nfunction endTagBeforeHtml(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) {\n    tokenBeforeHtml(p, token);\n  }\n}\nfunction tokenBeforeHtml(p, token) {\n  p._insertFakeRootElement();\n  p.insertionMode = BEFORE_HEAD_MODE;\n  p._processToken(token);\n}\n\n// The \"before head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.HEAD) {\n    p._insertElement(token, NS.HTML);\n    p.headElement = p.openElements.current;\n    p.insertionMode = IN_HEAD_MODE;\n  } else {\n    tokenBeforeHead(p, token);\n  }\n}\nfunction endTagBeforeHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) {\n    tokenBeforeHead(p, token);\n  } else {\n    p._err(ERR.endTagWithoutMatchingOpenElement);\n  }\n}\nfunction tokenBeforeHead(p, token) {\n  p._insertFakeElement($.HEAD);\n  p.headElement = p.openElements.current;\n  p.insertionMode = IN_HEAD_MODE;\n  p._processToken(token);\n}\n\n// The \"in head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n  } else if (tn === $.TITLE) {\n    p._switchToTextParsing(token, Tokenizer.MODE.RCDATA);\n  } else if (tn === $.NOSCRIPT) {\n    if (p.options.scriptingEnabled) {\n      p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n    } else {\n      p._insertElement(token, NS.HTML);\n      p.insertionMode = IN_HEAD_NO_SCRIPT_MODE;\n    }\n  } else if (tn === $.NOFRAMES || tn === $.STYLE) {\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n  } else if (tn === $.SCRIPT) {\n    p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);\n  } else if (tn === $.TEMPLATE) {\n    p._insertTemplate(token, NS.HTML);\n    p.activeFormattingElements.insertMarker();\n    p.framesetOk = false;\n    p.insertionMode = IN_TEMPLATE_MODE;\n    p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n  } else if (tn === $.HEAD) {\n    p._err(ERR.misplacedStartTagForHeadElement);\n  } else {\n    tokenInHead(p, token);\n  }\n}\nfunction endTagInHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HEAD) {\n    p.openElements.pop();\n    p.insertionMode = AFTER_HEAD_MODE;\n  } else if (tn === $.BODY || tn === $.BR || tn === $.HTML) {\n    tokenInHead(p, token);\n  } else if (tn === $.TEMPLATE) {\n    if (p.openElements.tmplCount > 0) {\n      p.openElements.generateImpliedEndTagsThoroughly();\n      if (p.openElements.currentTagName !== $.TEMPLATE) {\n        p._err(ERR.closingOfElementWithOpenChildElements);\n      }\n      p.openElements.popUntilTagNamePopped($.TEMPLATE);\n      p.activeFormattingElements.clearToLastMarker();\n      p._popTmplInsertionMode();\n      p._resetInsertionMode();\n    } else {\n      p._err(ERR.endTagWithoutMatchingOpenElement);\n    }\n  } else {\n    p._err(ERR.endTagWithoutMatchingOpenElement);\n  }\n}\nfunction tokenInHead(p, token) {\n  p.openElements.pop();\n  p.insertionMode = AFTER_HEAD_MODE;\n  p._processToken(token);\n}\n\n// The \"in head no script\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHeadNoScript(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.BASEFONT || tn === $.BGSOUND || tn === $.HEAD || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.STYLE) {\n    startTagInHead(p, token);\n  } else if (tn === $.NOSCRIPT) {\n    p._err(ERR.nestedNoscriptInHead);\n  } else {\n    tokenInHeadNoScript(p, token);\n  }\n}\nfunction endTagInHeadNoScript(p, token) {\n  const tn = token.tagName;\n  if (tn === $.NOSCRIPT) {\n    p.openElements.pop();\n    p.insertionMode = IN_HEAD_MODE;\n  } else if (tn === $.BR) {\n    tokenInHeadNoScript(p, token);\n  } else {\n    p._err(ERR.endTagWithoutMatchingOpenElement);\n  }\n}\nfunction tokenInHeadNoScript(p, token) {\n  const errCode = token.type === Tokenizer.EOF_TOKEN ? ERR.openElementsLeftAfterEof : ERR.disallowedContentInNoscriptInHead;\n  p._err(errCode);\n  p.openElements.pop();\n  p.insertionMode = IN_HEAD_MODE;\n  p._processToken(token);\n}\n\n// The \"after head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.BODY) {\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode = IN_BODY_MODE;\n  } else if (tn === $.FRAMESET) {\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_FRAMESET_MODE;\n  } else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\n    p._err(ERR.abandonedHeadElementChild);\n    p.openElements.push(p.headElement);\n    startTagInHead(p, token);\n    p.openElements.remove(p.headElement);\n  } else if (tn === $.HEAD) {\n    p._err(ERR.misplacedStartTagForHeadElement);\n  } else {\n    tokenAfterHead(p, token);\n  }\n}\nfunction endTagAfterHead(p, token) {\n  const tn = token.tagName;\n  if (tn === $.BODY || tn === $.HTML || tn === $.BR) {\n    tokenAfterHead(p, token);\n  } else if (tn === $.TEMPLATE) {\n    endTagInHead(p, token);\n  } else {\n    p._err(ERR.endTagWithoutMatchingOpenElement);\n  }\n}\nfunction tokenAfterHead(p, token) {\n  p._insertFakeElement($.BODY);\n  p.insertionMode = IN_BODY_MODE;\n  p._processToken(token);\n}\n\n// The \"in body\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertCharacters(token);\n}\nfunction characterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertCharacters(token);\n  p.framesetOk = false;\n}\nfunction htmlStartTagInBody(p, token) {\n  if (p.openElements.tmplCount === 0) {\n    p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n  }\n}\nfunction bodyStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n  if (bodyElement && p.openElements.tmplCount === 0) {\n    p.framesetOk = false;\n    p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n  }\n}\nfunction framesetStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n  if (p.framesetOk && bodyElement) {\n    p.treeAdapter.detachNode(bodyElement);\n    p.openElements.popAllUpToHtmlElement();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_FRAMESET_MODE;\n  }\n}\nfunction addressStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction numberedHeaderStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  const tn = p.openElements.currentTagName;\n  if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n    p.openElements.pop();\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction preStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n  //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n  p.skipNextNewLine = true;\n  p.framesetOk = false;\n}\nfunction formStartTagInBody(p, token) {\n  const inTemplate = p.openElements.tmplCount > 0;\n  if (!p.formElement || inTemplate) {\n    if (p.openElements.hasInButtonScope($.P)) {\n      p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    if (!inTemplate) {\n      p.formElement = p.openElements.current;\n    }\n  }\n}\nfunction listItemStartTagInBody(p, token) {\n  p.framesetOk = false;\n  const tn = token.tagName;\n  for (let i = p.openElements.stackTop; i >= 0; i--) {\n    const element = p.openElements.items[i];\n    const elementTn = p.treeAdapter.getTagName(element);\n    let closeTn = null;\n    if (tn === $.LI && elementTn === $.LI) {\n      closeTn = $.LI;\n    } else if ((tn === $.DD || tn === $.DT) && (elementTn === $.DD || elementTn === $.DT)) {\n      closeTn = elementTn;\n    }\n    if (closeTn) {\n      p.openElements.generateImpliedEndTagsWithExclusion(closeTn);\n      p.openElements.popUntilTagNamePopped(closeTn);\n      break;\n    }\n    if (elementTn !== $.ADDRESS && elementTn !== $.DIV && elementTn !== $.P && p._isSpecialElement(element)) {\n      break;\n    }\n  }\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction plaintextStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n  p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}\nfunction buttonStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BUTTON)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped($.BUTTON);\n  }\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n  p.framesetOk = false;\n}\nfunction aStartTagInBody(p, token) {\n  const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\n  if (activeElementEntry) {\n    callAdoptionAgency(p, token);\n    p.openElements.remove(activeElementEntry.element);\n    p.activeFormattingElements.removeEntry(activeElementEntry);\n  }\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction bStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction nobrStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  if (p.openElements.hasInScope($.NOBR)) {\n    callAdoptionAgency(p, token);\n    p._reconstructActiveFormattingElements();\n  }\n  p._insertElement(token, NS.HTML);\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction appletStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n  p.activeFormattingElements.insertMarker();\n  p.framesetOk = false;\n}\nfunction tableStartTagInBody(p, token) {\n  if (p.treeAdapter.getDocumentMode(p.document) !== HTML.DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n  p.framesetOk = false;\n  p.insertionMode = IN_TABLE_MODE;\n}\nfunction areaStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._appendElement(token, NS.HTML);\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\nfunction inputStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._appendElement(token, NS.HTML);\n  const inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE) {\n    p.framesetOk = false;\n  }\n  token.ackSelfClosing = true;\n}\nfunction paramStartTagInBody(p, token) {\n  p._appendElement(token, NS.HTML);\n  token.ackSelfClosing = true;\n}\nfunction hrStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._appendElement(token, NS.HTML);\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\nfunction imageStartTagInBody(p, token) {\n  token.tagName = $.IMG;\n  areaStartTagInBody(p, token);\n}\nfunction textareaStartTagInBody(p, token) {\n  p._insertElement(token, NS.HTML);\n  //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n  p.skipNextNewLine = true;\n  p.tokenizer.state = Tokenizer.MODE.RCDATA;\n  p.originalInsertionMode = p.insertionMode;\n  p.framesetOk = false;\n  p.insertionMode = TEXT_MODE;\n}\nfunction xmpStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._reconstructActiveFormattingElements();\n  p.framesetOk = false;\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\nfunction iframeStartTagInBody(p, token) {\n  p.framesetOk = false;\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as a rawtext.\nfunction noembedStartTagInBody(p, token) {\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\nfunction selectStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n  p.framesetOk = false;\n  if (p.insertionMode === IN_TABLE_MODE || p.insertionMode === IN_CAPTION_MODE || p.insertionMode === IN_TABLE_BODY_MODE || p.insertionMode === IN_ROW_MODE || p.insertionMode === IN_CELL_MODE) {\n    p.insertionMode = IN_SELECT_IN_TABLE_MODE;\n  } else {\n    p.insertionMode = IN_SELECT_MODE;\n  }\n}\nfunction optgroupStartTagInBody(p, token) {\n  if (p.openElements.currentTagName === $.OPTION) {\n    p.openElements.pop();\n  }\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n}\nfunction rbStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) {\n    p.openElements.generateImpliedEndTags();\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction rtStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction menuStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n  p._insertElement(token, NS.HTML);\n}\nfunction mathStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  foreignContent.adjustTokenMathMLAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) {\n    p._appendElement(token, NS.MATHML);\n  } else {\n    p._insertElement(token, NS.MATHML);\n  }\n  token.ackSelfClosing = true;\n}\nfunction svgStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  foreignContent.adjustTokenSVGAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) {\n    p._appendElement(token, NS.SVG);\n  } else {\n    p._insertElement(token, NS.SVG);\n  }\n  token.ackSelfClosing = true;\n}\nfunction genericStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n  p._insertElement(token, NS.HTML);\n}\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction startTagInBody(p, token) {\n  const tn = token.tagName;\n  switch (tn.length) {\n    case 1:\n      if (tn === $.I || tn === $.S || tn === $.B || tn === $.U) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.P) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.A) {\n        aStartTagInBody(p, token);\n      } else {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 2:\n      if (tn === $.DL || tn === $.OL || tn === $.UL) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n        numberedHeaderStartTagInBody(p, token);\n      } else if (tn === $.LI || tn === $.DD || tn === $.DT) {\n        listItemStartTagInBody(p, token);\n      } else if (tn === $.EM || tn === $.TT) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.BR) {\n        areaStartTagInBody(p, token);\n      } else if (tn === $.HR) {\n        hrStartTagInBody(p, token);\n      } else if (tn === $.RB) {\n        rbStartTagInBody(p, token);\n      } else if (tn === $.RT || tn === $.RP) {\n        rtStartTagInBody(p, token);\n      } else if (tn !== $.TH && tn !== $.TD && tn !== $.TR) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 3:\n      if (tn === $.DIV || tn === $.DIR || tn === $.NAV) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.PRE) {\n        preStartTagInBody(p, token);\n      } else if (tn === $.BIG) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.IMG || tn === $.WBR) {\n        areaStartTagInBody(p, token);\n      } else if (tn === $.XMP) {\n        xmpStartTagInBody(p, token);\n      } else if (tn === $.SVG) {\n        svgStartTagInBody(p, token);\n      } else if (tn === $.RTC) {\n        rbStartTagInBody(p, token);\n      } else if (tn !== $.COL) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 4:\n      if (tn === $.HTML) {\n        htmlStartTagInBody(p, token);\n      } else if (tn === $.BASE || tn === $.LINK || tn === $.META) {\n        startTagInHead(p, token);\n      } else if (tn === $.BODY) {\n        bodyStartTagInBody(p, token);\n      } else if (tn === $.MAIN || tn === $.MENU) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.FORM) {\n        formStartTagInBody(p, token);\n      } else if (tn === $.CODE || tn === $.FONT) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.NOBR) {\n        nobrStartTagInBody(p, token);\n      } else if (tn === $.AREA) {\n        areaStartTagInBody(p, token);\n      } else if (tn === $.MATH) {\n        mathStartTagInBody(p, token);\n      } else if (tn === $.MENU) {\n        menuStartTagInBody(p, token);\n      } else if (tn !== $.HEAD) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 5:\n      if (tn === $.STYLE || tn === $.TITLE) {\n        startTagInHead(p, token);\n      } else if (tn === $.ASIDE) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.SMALL) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.TABLE) {\n        tableStartTagInBody(p, token);\n      } else if (tn === $.EMBED) {\n        areaStartTagInBody(p, token);\n      } else if (tn === $.INPUT) {\n        inputStartTagInBody(p, token);\n      } else if (tn === $.PARAM || tn === $.TRACK) {\n        paramStartTagInBody(p, token);\n      } else if (tn === $.IMAGE) {\n        imageStartTagInBody(p, token);\n      } else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 6:\n      if (tn === $.SCRIPT) {\n        startTagInHead(p, token);\n      } else if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP || tn === $.DIALOG) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.BUTTON) {\n        buttonStartTagInBody(p, token);\n      } else if (tn === $.STRIKE || tn === $.STRONG) {\n        bStartTagInBody(p, token);\n      } else if (tn === $.APPLET || tn === $.OBJECT) {\n        appletStartTagInBody(p, token);\n      } else if (tn === $.KEYGEN) {\n        areaStartTagInBody(p, token);\n      } else if (tn === $.SOURCE) {\n        paramStartTagInBody(p, token);\n      } else if (tn === $.IFRAME) {\n        iframeStartTagInBody(p, token);\n      } else if (tn === $.SELECT) {\n        selectStartTagInBody(p, token);\n      } else if (tn === $.OPTION) {\n        optgroupStartTagInBody(p, token);\n      } else {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 7:\n      if (tn === $.BGSOUND) {\n        startTagInHead(p, token);\n      } else if (tn === $.DETAILS || tn === $.ADDRESS || tn === $.ARTICLE || tn === $.SECTION || tn === $.SUMMARY) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.LISTING) {\n        preStartTagInBody(p, token);\n      } else if (tn === $.MARQUEE) {\n        appletStartTagInBody(p, token);\n      } else if (tn === $.NOEMBED) {\n        noembedStartTagInBody(p, token);\n      } else if (tn !== $.CAPTION) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 8:\n      if (tn === $.BASEFONT) {\n        startTagInHead(p, token);\n      } else if (tn === $.FRAMESET) {\n        framesetStartTagInBody(p, token);\n      } else if (tn === $.FIELDSET) {\n        addressStartTagInBody(p, token);\n      } else if (tn === $.TEXTAREA) {\n        textareaStartTagInBody(p, token);\n      } else if (tn === $.TEMPLATE) {\n        startTagInHead(p, token);\n      } else if (tn === $.NOSCRIPT) {\n        if (p.options.scriptingEnabled) {\n          noembedStartTagInBody(p, token);\n        } else {\n          genericStartTagInBody(p, token);\n        }\n      } else if (tn === $.OPTGROUP) {\n        optgroupStartTagInBody(p, token);\n      } else if (tn !== $.COLGROUP) {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 9:\n      if (tn === $.PLAINTEXT) {\n        plaintextStartTagInBody(p, token);\n      } else {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) {\n        addressStartTagInBody(p, token);\n      } else {\n        genericStartTagInBody(p, token);\n      }\n      break;\n    default:\n      genericStartTagInBody(p, token);\n  }\n}\nfunction bodyEndTagInBody(p) {\n  if (p.openElements.hasInScope($.BODY)) {\n    p.insertionMode = AFTER_BODY_MODE;\n  }\n}\nfunction htmlEndTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BODY)) {\n    p.insertionMode = AFTER_BODY_MODE;\n    p._processToken(token);\n  }\n}\nfunction addressEndTagInBody(p, token) {\n  const tn = token.tagName;\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\nfunction formEndTagInBody(p) {\n  const inTemplate = p.openElements.tmplCount > 0;\n  const formElement = p.formElement;\n  if (!inTemplate) {\n    p.formElement = null;\n  }\n  if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n    p.openElements.generateImpliedEndTags();\n    if (inTemplate) {\n      p.openElements.popUntilTagNamePopped($.FORM);\n    } else {\n      p.openElements.remove(formElement);\n    }\n  }\n}\nfunction pEndTagInBody(p) {\n  if (!p.openElements.hasInButtonScope($.P)) {\n    p._insertFakeElement($.P);\n  }\n  p._closePElement();\n}\nfunction liEndTagInBody(p) {\n  if (p.openElements.hasInListItemScope($.LI)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n    p.openElements.popUntilTagNamePopped($.LI);\n  }\n}\nfunction ddEndTagInBody(p, token) {\n  const tn = token.tagName;\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(tn);\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\nfunction numberedHeaderEndTagInBody(p) {\n  if (p.openElements.hasNumberedHeaderInScope()) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilNumberedHeaderPopped();\n  }\n}\nfunction appletEndTagInBody(p, token) {\n  const tn = token.tagName;\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n    p.activeFormattingElements.clearToLastMarker();\n  }\n}\nfunction brEndTagInBody(p) {\n  p._reconstructActiveFormattingElements();\n  p._insertFakeElement($.BR);\n  p.openElements.pop();\n  p.framesetOk = false;\n}\nfunction genericEndTagInBody(p, token) {\n  const tn = token.tagName;\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n    if (p.treeAdapter.getTagName(element) === tn) {\n      p.openElements.generateImpliedEndTagsWithExclusion(tn);\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n    if (p._isSpecialElement(element)) {\n      break;\n    }\n  }\n}\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction endTagInBody(p, token) {\n  const tn = token.tagName;\n  switch (tn.length) {\n    case 1:\n      if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn === $.U) {\n        callAdoptionAgency(p, token);\n      } else if (tn === $.P) {\n        pEndTagInBody(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 2:\n      if (tn === $.DL || tn === $.UL || tn === $.OL) {\n        addressEndTagInBody(p, token);\n      } else if (tn === $.LI) {\n        liEndTagInBody(p, token);\n      } else if (tn === $.DD || tn === $.DT) {\n        ddEndTagInBody(p, token);\n      } else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n        numberedHeaderEndTagInBody(p, token);\n      } else if (tn === $.BR) {\n        brEndTagInBody(p, token);\n      } else if (tn === $.EM || tn === $.TT) {\n        callAdoptionAgency(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 3:\n      if (tn === $.BIG) {\n        callAdoptionAgency(p, token);\n      } else if (tn === $.DIR || tn === $.DIV || tn === $.NAV || tn === $.PRE) {\n        addressEndTagInBody(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 4:\n      if (tn === $.BODY) {\n        bodyEndTagInBody(p, token);\n      } else if (tn === $.HTML) {\n        htmlEndTagInBody(p, token);\n      } else if (tn === $.FORM) {\n        formEndTagInBody(p, token);\n      } else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR) {\n        callAdoptionAgency(p, token);\n      } else if (tn === $.MAIN || tn === $.MENU) {\n        addressEndTagInBody(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 5:\n      if (tn === $.ASIDE) {\n        addressEndTagInBody(p, token);\n      } else if (tn === $.SMALL) {\n        callAdoptionAgency(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 6:\n      if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP || tn === $.DIALOG) {\n        addressEndTagInBody(p, token);\n      } else if (tn === $.APPLET || tn === $.OBJECT) {\n        appletEndTagInBody(p, token);\n      } else if (tn === $.STRIKE || tn === $.STRONG) {\n        callAdoptionAgency(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 7:\n      if (tn === $.ADDRESS || tn === $.ARTICLE || tn === $.DETAILS || tn === $.SECTION || tn === $.SUMMARY || tn === $.LISTING) {\n        addressEndTagInBody(p, token);\n      } else if (tn === $.MARQUEE) {\n        appletEndTagInBody(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 8:\n      if (tn === $.FIELDSET) {\n        addressEndTagInBody(p, token);\n      } else if (tn === $.TEMPLATE) {\n        endTagInHead(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) {\n        addressEndTagInBody(p, token);\n      } else {\n        genericEndTagInBody(p, token);\n      }\n      break;\n    default:\n      genericEndTagInBody(p, token);\n  }\n}\nfunction eofInBody(p, token) {\n  if (p.tmplInsertionModeStackTop > -1) {\n    eofInTemplate(p, token);\n  } else {\n    p.stopped = true;\n  }\n}\n\n// The \"text\" insertion mode\n//------------------------------------------------------------------\nfunction endTagInText(p, token) {\n  if (token.tagName === $.SCRIPT) {\n    p.pendingScript = p.openElements.current;\n  }\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n}\nfunction eofInText(p, token) {\n  p._err(ERR.eofInElementThatCanContainOnlyText);\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n  p._processToken(token);\n}\n\n// The \"in table\" insertion mode\n//------------------------------------------------------------------\nfunction characterInTable(p, token) {\n  const curTn = p.openElements.currentTagName;\n  if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\n    p.pendingCharacterTokens = [];\n    p.hasNonWhitespacePendingCharacterToken = false;\n    p.originalInsertionMode = p.insertionMode;\n    p.insertionMode = IN_TABLE_TEXT_MODE;\n    p._processToken(token);\n  } else {\n    tokenInTable(p, token);\n  }\n}\nfunction captionStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p.activeFormattingElements.insertMarker();\n  p._insertElement(token, NS.HTML);\n  p.insertionMode = IN_CAPTION_MODE;\n}\nfunction colgroupStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p._insertElement(token, NS.HTML);\n  p.insertionMode = IN_COLUMN_GROUP_MODE;\n}\nfunction colStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p._insertFakeElement($.COLGROUP);\n  p.insertionMode = IN_COLUMN_GROUP_MODE;\n  p._processToken(token);\n}\nfunction tbodyStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p._insertElement(token, NS.HTML);\n  p.insertionMode = IN_TABLE_BODY_MODE;\n}\nfunction tdStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p._insertFakeElement($.TBODY);\n  p.insertionMode = IN_TABLE_BODY_MODE;\n  p._processToken(token);\n}\nfunction tableStartTagInTable(p, token) {\n  if (p.openElements.hasInTableScope($.TABLE)) {\n    p.openElements.popUntilTagNamePopped($.TABLE);\n    p._resetInsertionMode();\n    p._processToken(token);\n  }\n}\nfunction inputStartTagInTable(p, token) {\n  const inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE) {\n    p._appendElement(token, NS.HTML);\n  } else {\n    tokenInTable(p, token);\n  }\n  token.ackSelfClosing = true;\n}\nfunction formStartTagInTable(p, token) {\n  if (!p.formElement && p.openElements.tmplCount === 0) {\n    p._insertElement(token, NS.HTML);\n    p.formElement = p.openElements.current;\n    p.openElements.pop();\n  }\n}\nfunction startTagInTable(p, token) {\n  const tn = token.tagName;\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH || tn === $.TR) {\n        tdStartTagInTable(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 3:\n      if (tn === $.COL) {\n        colStartTagInTable(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 4:\n      if (tn === $.FORM) {\n        formStartTagInTable(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 5:\n      if (tn === $.TABLE) {\n        tableStartTagInTable(p, token);\n      } else if (tn === $.STYLE) {\n        startTagInHead(p, token);\n      } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n        tbodyStartTagInTable(p, token);\n      } else if (tn === $.INPUT) {\n        inputStartTagInTable(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 6:\n      if (tn === $.SCRIPT) {\n        startTagInHead(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 7:\n      if (tn === $.CAPTION) {\n        captionStartTagInTable(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    case 8:\n      if (tn === $.COLGROUP) {\n        colgroupStartTagInTable(p, token);\n      } else if (tn === $.TEMPLATE) {\n        startTagInHead(p, token);\n      } else {\n        tokenInTable(p, token);\n      }\n      break;\n    default:\n      tokenInTable(p, token);\n  }\n}\nfunction endTagInTable(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n      p.openElements.popUntilTagNamePopped($.TABLE);\n      p._resetInsertionMode();\n    }\n  } else if (tn === $.TEMPLATE) {\n    endTagInHead(p, token);\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\n    tokenInTable(p, token);\n  }\n}\nfunction tokenInTable(p, token) {\n  const savedFosterParentingState = p.fosterParentingEnabled;\n  p.fosterParentingEnabled = true;\n  p._processTokenInBodyMode(token);\n  p.fosterParentingEnabled = savedFosterParentingState;\n}\n\n// The \"in table text\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n}\nfunction characterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n  p.hasNonWhitespacePendingCharacterToken = true;\n}\nfunction tokenInTableText(p, token) {\n  let i = 0;\n  if (p.hasNonWhitespacePendingCharacterToken) {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      tokenInTable(p, p.pendingCharacterTokens[i]);\n    }\n  } else {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      p._insertCharacters(p.pendingCharacterTokens[i]);\n    }\n  }\n  p.insertionMode = p.originalInsertionMode;\n  p._processToken(token);\n}\n\n// The \"in caption\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCaption(p, token) {\n  const tn = token.tagName;\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_TABLE_MODE;\n      p._processToken(token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\nfunction endTagInCaption(p, token) {\n  const tn = token.tagName;\n  if (tn === $.CAPTION || tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_TABLE_MODE;\n      if (tn === $.TABLE) {\n        p._processToken(token);\n      }\n    }\n  } else if (tn !== $.BODY && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\n    endTagInBody(p, token);\n  }\n}\n\n// The \"in column group\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInColumnGroup(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.COL) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n  } else if (tn === $.TEMPLATE) {\n    startTagInHead(p, token);\n  } else {\n    tokenInColumnGroup(p, token);\n  }\n}\nfunction endTagInColumnGroup(p, token) {\n  const tn = token.tagName;\n  if (tn === $.COLGROUP) {\n    if (p.openElements.currentTagName === $.COLGROUP) {\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TEMPLATE) {\n    endTagInHead(p, token);\n  } else if (tn !== $.COL) {\n    tokenInColumnGroup(p, token);\n  }\n}\nfunction tokenInColumnGroup(p, token) {\n  if (p.openElements.currentTagName === $.COLGROUP) {\n    p.openElements.pop();\n    p.insertionMode = IN_TABLE_MODE;\n    p._processToken(token);\n  }\n}\n\n// The \"in table body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTableBody(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TR) {\n    p.openElements.clearBackToTableBodyContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_ROW_MODE;\n  } else if (tn === $.TH || tn === $.TD) {\n    p.openElements.clearBackToTableBodyContext();\n    p._insertFakeElement($.TR);\n    p.insertionMode = IN_ROW_MODE;\n    p._processToken(token);\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n      p._processToken(token);\n    }\n  } else {\n    startTagInTable(p, token);\n  }\n}\nfunction endTagInTableBody(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TABLE) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR) {\n    endTagInTable(p, token);\n  }\n}\n\n// The \"in row\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInRow(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TH || tn === $.TD) {\n    p.openElements.clearBackToTableRowContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_CELL_MODE;\n    p.activeFormattingElements.insertMarker();\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n      p._processToken(token);\n    }\n  } else {\n    startTagInTable(p, token);\n  }\n}\nfunction endTagInRow(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n    }\n  } else if (tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n      p._processToken(token);\n    }\n  } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn) || p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH) {\n    endTagInTable(p, token);\n  }\n}\n\n// The \"in cell\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCell(p, token) {\n  const tn = token.tagName;\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n      p._closeTableCell();\n      p._processToken(token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\nfunction endTagInCell(p, token) {\n  const tn = token.tagName;\n  if (tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped(tn);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_ROW_MODE;\n    }\n  } else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p._closeTableCell();\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML) {\n    endTagInBody(p, token);\n  }\n}\n\n// The \"in select\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelect(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) {\n      p.openElements.pop();\n    }\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.OPTGROUP) {\n    if (p.openElements.currentTagName === $.OPTION) {\n      p.openElements.pop();\n    }\n    if (p.openElements.currentTagName === $.OPTGROUP) {\n      p.openElements.pop();\n    }\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA || tn === $.SELECT) {\n    if (p.openElements.hasInSelectScope($.SELECT)) {\n      p.openElements.popUntilTagNamePopped($.SELECT);\n      p._resetInsertionMode();\n      if (tn !== $.SELECT) {\n        p._processToken(token);\n      }\n    }\n  } else if (tn === $.SCRIPT || tn === $.TEMPLATE) {\n    startTagInHead(p, token);\n  }\n}\nfunction endTagInSelect(p, token) {\n  const tn = token.tagName;\n  if (tn === $.OPTGROUP) {\n    const prevOpenElement = p.openElements.items[p.openElements.stackTop - 1];\n    const prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\n    if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP) {\n      p.openElements.pop();\n    }\n    if (p.openElements.currentTagName === $.OPTGROUP) {\n      p.openElements.pop();\n    }\n  } else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) {\n      p.openElements.pop();\n    }\n  } else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n    p._resetInsertionMode();\n  } else if (tn === $.TEMPLATE) {\n    endTagInHead(p, token);\n  }\n}\n\n//12.2.5.4.17 The \"in select in table\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelectInTable(p, token) {\n  const tn = token.tagName;\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n    p._resetInsertionMode();\n    p._processToken(token);\n  } else {\n    startTagInSelect(p, token);\n  }\n}\nfunction endTagInSelectInTable(p, token) {\n  const tn = token.tagName;\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.popUntilTagNamePopped($.SELECT);\n      p._resetInsertionMode();\n      p._processToken(token);\n    }\n  } else {\n    endTagInSelect(p, token);\n  }\n}\n\n// The \"in template\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTemplate(p, token) {\n  const tn = token.tagName;\n  if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\n    startTagInHead(p, token);\n  } else {\n    const newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\n    p._popTmplInsertionMode();\n    p._pushTmplInsertionMode(newInsertionMode);\n    p.insertionMode = newInsertionMode;\n    p._processToken(token);\n  }\n}\nfunction endTagInTemplate(p, token) {\n  if (token.tagName === $.TEMPLATE) {\n    endTagInHead(p, token);\n  }\n}\nfunction eofInTemplate(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.popUntilTagNamePopped($.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n    p._popTmplInsertionMode();\n    p._resetInsertionMode();\n    p._processToken(token);\n  } else {\n    p.stopped = true;\n  }\n}\n\n// The \"after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\nfunction endTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) {\n    if (!p.fragmentContext) {\n      p.insertionMode = AFTER_AFTER_BODY_MODE;\n    }\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\nfunction tokenAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n  p._processToken(token);\n}\n\n// The \"in frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInFrameset(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.FRAMESET) {\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.FRAME) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n  } else if (tn === $.NOFRAMES) {\n    startTagInHead(p, token);\n  }\n}\nfunction endTagInFrameset(p, token) {\n  if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n    p.openElements.pop();\n    if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET) {\n      p.insertionMode = AFTER_FRAMESET_MODE;\n    }\n  }\n}\n\n// The \"after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterFrameset(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.NOFRAMES) {\n    startTagInHead(p, token);\n  }\n}\nfunction endTagAfterFrameset(p, token) {\n  if (token.tagName === $.HTML) {\n    p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\n  }\n}\n\n// The \"after after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterBody(p, token) {\n  if (token.tagName === $.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterAfterBody(p, token);\n  }\n}\nfunction tokenAfterAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n  p._processToken(token);\n}\n\n// The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterFrameset(p, token) {\n  const tn = token.tagName;\n  if (tn === $.HTML) {\n    startTagInBody(p, token);\n  } else if (tn === $.NOFRAMES) {\n    startTagInHead(p, token);\n  }\n}\n\n// The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\nfunction nullCharacterInForeignContent(p, token) {\n  token.chars = unicode.REPLACEMENT_CHARACTER;\n  p._insertCharacters(token);\n}\nfunction characterInForeignContent(p, token) {\n  p._insertCharacters(token);\n  p.framesetOk = false;\n}\nfunction startTagInForeignContent(p, token) {\n  if (foreignContent.causesExit(token) && !p.fragmentContext) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML && !p._isIntegrationPoint(p.openElements.current)) {\n      p.openElements.pop();\n    }\n    p._processToken(token);\n  } else {\n    const current = p._getAdjustedCurrentElement();\n    const currentNs = p.treeAdapter.getNamespaceURI(current);\n    if (currentNs === NS.MATHML) {\n      foreignContent.adjustTokenMathMLAttrs(token);\n    } else if (currentNs === NS.SVG) {\n      foreignContent.adjustTokenSVGTagName(token);\n      foreignContent.adjustTokenSVGAttrs(token);\n    }\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n      p._appendElement(token, currentNs);\n    } else {\n      p._insertElement(token, currentNs);\n    }\n    token.ackSelfClosing = true;\n  }\n}\nfunction endTagInForeignContent(p, token) {\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n    if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n      p._processToken(token);\n      break;\n    }\n    if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n  }\n}","map":{"version":3,"names":["Tokenizer","require","OpenElementStack","FormattingElementList","LocationInfoParserMixin","ErrorReportingParserMixin","Mixin","defaultTreeAdapter","mergeOptions","doctype","foreignContent","ERR","unicode","HTML","$","TAG_NAMES","NS","NAMESPACES","ATTRS","DEFAULT_OPTIONS","scriptingEnabled","sourceCodeLocationInfo","onParseError","treeAdapter","HIDDEN_INPUT_TYPE","AA_OUTER_LOOP_ITER","AA_INNER_LOOP_ITER","INITIAL_MODE","BEFORE_HTML_MODE","BEFORE_HEAD_MODE","IN_HEAD_MODE","IN_HEAD_NO_SCRIPT_MODE","AFTER_HEAD_MODE","IN_BODY_MODE","TEXT_MODE","IN_TABLE_MODE","IN_TABLE_TEXT_MODE","IN_CAPTION_MODE","IN_COLUMN_GROUP_MODE","IN_TABLE_BODY_MODE","IN_ROW_MODE","IN_CELL_MODE","IN_SELECT_MODE","IN_SELECT_IN_TABLE_MODE","IN_TEMPLATE_MODE","AFTER_BODY_MODE","IN_FRAMESET_MODE","AFTER_FRAMESET_MODE","AFTER_AFTER_BODY_MODE","AFTER_AFTER_FRAMESET_MODE","INSERTION_MODE_RESET_MAP","TR","TBODY","THEAD","TFOOT","CAPTION","COLGROUP","TABLE","BODY","FRAMESET","TEMPLATE_INSERTION_MODE_SWITCH_MAP","COL","TD","TH","TOKEN_HANDLERS","CHARACTER_TOKEN","tokenInInitialMode","NULL_CHARACTER_TOKEN","WHITESPACE_CHARACTER_TOKEN","ignoreToken","COMMENT_TOKEN","appendComment","DOCTYPE_TOKEN","doctypeInInitialMode","START_TAG_TOKEN","END_TAG_TOKEN","EOF_TOKEN","tokenBeforeHtml","startTagBeforeHtml","endTagBeforeHtml","tokenBeforeHead","misplacedDoctype","startTagBeforeHead","endTagBeforeHead","tokenInHead","insertCharacters","startTagInHead","endTagInHead","tokenInHeadNoScript","startTagInHeadNoScript","endTagInHeadNoScript","tokenAfterHead","startTagAfterHead","endTagAfterHead","characterInBody","whitespaceCharacterInBody","startTagInBody","endTagInBody","eofInBody","endTagInText","eofInText","characterInTable","startTagInTable","endTagInTable","characterInTableText","whitespaceCharacterInTableText","tokenInTableText","startTagInCaption","endTagInCaption","tokenInColumnGroup","startTagInColumnGroup","endTagInColumnGroup","startTagInTableBody","endTagInTableBody","startTagInRow","endTagInRow","startTagInCell","endTagInCell","startTagInSelect","endTagInSelect","startTagInSelectInTable","endTagInSelectInTable","startTagInTemplate","endTagInTemplate","eofInTemplate","tokenAfterBody","appendCommentToRootHtmlElement","startTagAfterBody","endTagAfterBody","stopParsing","startTagInFrameset","endTagInFrameset","startTagAfterFrameset","endTagAfterFrameset","tokenAfterAfterBody","appendCommentToDocument","startTagAfterAfterBody","startTagAfterAfterFrameset","Parser","constructor","options","pendingScript","install","parse","html","document","createDocument","_bootstrap","tokenizer","write","_runParsingLoop","parseFragment","fragmentContext","createElement","TEMPLATE","documentMock","getTagName","_pushTmplInsertionMode","_initTokenizerForFragmentParsing","_insertFakeRootElement","_resetInsertionMode","_findFormInFragmentContext","rootElement","getFirstChild","fragment","createDocumentFragment","_adoptNodes","stopped","insertionMode","originalInsertionMode","headElement","formElement","openElements","activeFormattingElements","tmplInsertionModeStack","tmplInsertionModeStackTop","currentTmplInsertionMode","pendingCharacterTokens","hasNonWhitespacePendingCharacterToken","framesetOk","skipNextNewLine","fosterParentingEnabled","_err","scriptHandler","_setupTokenizerCDATAMode","token","getNextToken","type","HIBERNATION_TOKEN","chars","length","substr","_processInputToken","runParsingLoopForCurrentChunk","writeCallback","script","current","_getAdjustedCurrentElement","allowCDATA","getNamespaceURI","_isIntegrationPoint","_switchToTextParsing","currentToken","nextTokenizerState","_insertElement","state","switchToPlaintextParsing","MODE","PLAINTEXT","stackTop","node","FORM","getParentNode","tn","TITLE","TEXTAREA","RCDATA","STYLE","XMP","IFRAME","NOEMBED","NOFRAMES","NOSCRIPT","RAWTEXT","SCRIPT","SCRIPT_DATA","_setDocumentType","name","publicId","systemId","setDocumentType","_attachElementToTree","element","_shouldFosterParentOnInsertion","_fosterParentElement","parent","currentTmplContent","appendChild","_appendElement","namespaceURI","tagName","attrs","push","_insertFakeElement","_insertTemplate","tmpl","content","setTemplateContent","_appendCommentNode","commentNode","createCommentNode","data","_insertCharacters","_fosterParentText","insertText","donor","recipient","child","detachNode","_shouldProcessTokenInForeignContent","ns","ANNOTATION_XML","MATHML","SVG","isCharacterToken","isMathMLTextStartTag","MGLYPH","MALIGNMARK","_processToken","_processTokenInBodyMode","_processTokenInForeignContent","characterInForeignContent","nullCharacterInForeignContent","startTagInForeignContent","endTagInForeignContent","selfClosing","ackSelfClosing","nonVoidHtmlElementStartTagWithTrailingSolidus","foreignNS","getAttrList","isIntegrationPoint","_reconstructActiveFormattingElements","listLength","unopenIdx","entry","entries","MARKER_ENTRY","contains","i","_closeTableCell","generateImpliedEndTags","popUntilTableCellPopped","clearToLastMarker","_closePElement","generateImpliedEndTagsWithExclusion","P","popUntilTagNamePopped","last","items","newInsertionMode","HEAD","SELECT","_resetInsertionModeForSelect","selectIdx","ancestor","mode","_popTmplInsertionMode","pop","_isElementCausesFosterParenting","_findFosterParentingLocation","location","beforeElement","openElement","getTemplateContent","insertBefore","insertTextBefore","_isSpecialElement","SPECIAL_ELEMENTS","module","exports","aaObtainFormattingElementEntry","p","formattingElementEntry","getElementEntryInScopeWithTagName","removeEntry","hasInScope","genericEndTagInBody","aaObtainFurthestBlock","furthestBlock","popUntilElementPopped","aaInnerLoop","formattingElement","lastElement","nextElement","getCommonAncestor","elementEntry","getElementEntry","counterOverflow","shouldRemoveFromOpenElements","remove","aaRecreateElementFromEntry","bookmark","newElement","replace","aaInsertLastNodeInCommonAncestor","commonAncestor","aaReplaceFormattingElement","insertElementAfterBookmark","insertAfter","callAdoptionAgency","forceQuirks","DOCUMENT_MODE","QUIRKS","getDocumentMode","isConforming","nonConformingDoctype","setDocumentMode","missingDoctype","beforeToken","BR","endTagWithoutMatchingOpenElement","BASE","BASEFONT","BGSOUND","LINK","META","insertMarker","misplacedStartTagForHeadElement","tmplCount","generateImpliedEndTagsThoroughly","currentTagName","closingOfElementWithOpenChildElements","nestedNoscriptInHead","errCode","openElementsLeftAfterEof","disallowedContentInNoscriptInHead","abandonedHeadElementChild","htmlStartTagInBody","adoptAttributes","bodyStartTagInBody","bodyElement","tryPeekProperlyNestedBodyElement","framesetStartTagInBody","popAllUpToHtmlElement","addressStartTagInBody","hasInButtonScope","numberedHeaderStartTagInBody","H1","H2","H3","H4","H5","H6","preStartTagInBody","formStartTagInBody","inTemplate","listItemStartTagInBody","elementTn","closeTn","LI","DD","DT","ADDRESS","DIV","plaintextStartTagInBody","buttonStartTagInBody","BUTTON","aStartTagInBody","activeElementEntry","A","pushElement","bStartTagInBody","nobrStartTagInBody","NOBR","appletStartTagInBody","tableStartTagInBody","areaStartTagInBody","inputStartTagInBody","inputType","getTokenAttr","TYPE","toLowerCase","paramStartTagInBody","hrStartTagInBody","imageStartTagInBody","IMG","textareaStartTagInBody","xmpStartTagInBody","iframeStartTagInBody","noembedStartTagInBody","selectStartTagInBody","optgroupStartTagInBody","OPTION","rbStartTagInBody","RUBY","rtStartTagInBody","RTC","menuStartTagInBody","mathStartTagInBody","adjustTokenMathMLAttrs","adjustTokenXMLAttrs","svgStartTagInBody","adjustTokenSVGAttrs","genericStartTagInBody","I","S","B","U","DL","OL","UL","EM","TT","HR","RB","RT","RP","DIR","NAV","PRE","BIG","WBR","MAIN","MENU","CODE","FONT","AREA","MATH","ASIDE","SMALL","EMBED","INPUT","PARAM","TRACK","IMAGE","FRAME","CENTER","FIGURE","FOOTER","HEADER","HGROUP","DIALOG","STRIKE","STRONG","APPLET","OBJECT","KEYGEN","SOURCE","DETAILS","ARTICLE","SECTION","SUMMARY","LISTING","MARQUEE","FIELDSET","OPTGROUP","BLOCKQUOTE","FIGCAPTION","bodyEndTagInBody","htmlEndTagInBody","addressEndTagInBody","formEndTagInBody","pEndTagInBody","liEndTagInBody","hasInListItemScope","ddEndTagInBody","numberedHeaderEndTagInBody","hasNumberedHeaderInScope","popUntilNumberedHeaderPopped","appletEndTagInBody","brEndTagInBody","eofInElementThatCanContainOnlyText","curTn","tokenInTable","captionStartTagInTable","clearBackToTableContext","colgroupStartTagInTable","colStartTagInTable","tbodyStartTagInTable","tdStartTagInTable","tableStartTagInTable","hasInTableScope","inputStartTagInTable","formStartTagInTable","savedFosterParentingState","clearBackToTableBodyContext","hasTableBodyContextInTableScope","clearBackToTableRowContext","hasInSelectScope","prevOpenElement","prevOpenElementTn","isRootHtmlElementCurrent","REPLACEMENT_CHARACTER","causesExit","currentNs","adjustTokenSVGTagName"],"sources":["/Users/jiangzilong//minpg/Heptabase-Blog/node_modules/parse5/lib/parser/index.js"],"sourcesContent":["'use strict';\n\nconst Tokenizer = require('../tokenizer');\nconst OpenElementStack = require('./open-element-stack');\nconst FormattingElementList = require('./formatting-element-list');\nconst LocationInfoParserMixin = require('../extensions/location-info/parser-mixin');\nconst ErrorReportingParserMixin = require('../extensions/error-reporting/parser-mixin');\nconst Mixin = require('../utils/mixin');\nconst defaultTreeAdapter = require('../tree-adapters/default');\nconst mergeOptions = require('../utils/merge-options');\nconst doctype = require('../common/doctype');\nconst foreignContent = require('../common/foreign-content');\nconst ERR = require('../common/error-codes');\nconst unicode = require('../common/unicode');\nconst HTML = require('../common/html');\n\n//Aliases\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\nconst ATTRS = HTML.ATTRS;\n\nconst DEFAULT_OPTIONS = {\n    scriptingEnabled: true,\n    sourceCodeLocationInfo: false,\n    onParseError: null,\n    treeAdapter: defaultTreeAdapter\n};\n\n//Misc constants\nconst HIDDEN_INPUT_TYPE = 'hidden';\n\n//Adoption agency loops iteration count\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3;\n\n//Insertion modes\nconst INITIAL_MODE = 'INITIAL_MODE';\nconst BEFORE_HTML_MODE = 'BEFORE_HTML_MODE';\nconst BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE';\nconst IN_HEAD_MODE = 'IN_HEAD_MODE';\nconst IN_HEAD_NO_SCRIPT_MODE = 'IN_HEAD_NO_SCRIPT_MODE';\nconst AFTER_HEAD_MODE = 'AFTER_HEAD_MODE';\nconst IN_BODY_MODE = 'IN_BODY_MODE';\nconst TEXT_MODE = 'TEXT_MODE';\nconst IN_TABLE_MODE = 'IN_TABLE_MODE';\nconst IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE';\nconst IN_CAPTION_MODE = 'IN_CAPTION_MODE';\nconst IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE';\nconst IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE';\nconst IN_ROW_MODE = 'IN_ROW_MODE';\nconst IN_CELL_MODE = 'IN_CELL_MODE';\nconst IN_SELECT_MODE = 'IN_SELECT_MODE';\nconst IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE';\nconst IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE';\nconst AFTER_BODY_MODE = 'AFTER_BODY_MODE';\nconst IN_FRAMESET_MODE = 'IN_FRAMESET_MODE';\nconst AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE';\nconst AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE';\nconst AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE';\n\n//Insertion mode reset map\nconst INSERTION_MODE_RESET_MAP = {\n    [$.TR]: IN_ROW_MODE,\n    [$.TBODY]: IN_TABLE_BODY_MODE,\n    [$.THEAD]: IN_TABLE_BODY_MODE,\n    [$.TFOOT]: IN_TABLE_BODY_MODE,\n    [$.CAPTION]: IN_CAPTION_MODE,\n    [$.COLGROUP]: IN_COLUMN_GROUP_MODE,\n    [$.TABLE]: IN_TABLE_MODE,\n    [$.BODY]: IN_BODY_MODE,\n    [$.FRAMESET]: IN_FRAMESET_MODE\n};\n\n//Template insertion mode switch map\nconst TEMPLATE_INSERTION_MODE_SWITCH_MAP = {\n    [$.CAPTION]: IN_TABLE_MODE,\n    [$.COLGROUP]: IN_TABLE_MODE,\n    [$.TBODY]: IN_TABLE_MODE,\n    [$.TFOOT]: IN_TABLE_MODE,\n    [$.THEAD]: IN_TABLE_MODE,\n    [$.COL]: IN_COLUMN_GROUP_MODE,\n    [$.TR]: IN_TABLE_BODY_MODE,\n    [$.TD]: IN_ROW_MODE,\n    [$.TH]: IN_ROW_MODE\n};\n\n//Token handlers map for insertion modes\nconst TOKEN_HANDLERS = {\n    [INITIAL_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenInInitialMode,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInInitialMode,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: doctypeInInitialMode,\n        [Tokenizer.START_TAG_TOKEN]: tokenInInitialMode,\n        [Tokenizer.END_TAG_TOKEN]: tokenInInitialMode,\n        [Tokenizer.EOF_TOKEN]: tokenInInitialMode\n    },\n    [BEFORE_HTML_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenBeforeHtml,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenBeforeHtml,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagBeforeHtml,\n        [Tokenizer.END_TAG_TOKEN]: endTagBeforeHtml,\n        [Tokenizer.EOF_TOKEN]: tokenBeforeHtml\n    },\n    [BEFORE_HEAD_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenBeforeHead,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenBeforeHead,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n        [Tokenizer.START_TAG_TOKEN]: startTagBeforeHead,\n        [Tokenizer.END_TAG_TOKEN]: endTagBeforeHead,\n        [Tokenizer.EOF_TOKEN]: tokenBeforeHead\n    },\n    [IN_HEAD_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenInHead,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInHead,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n        [Tokenizer.START_TAG_TOKEN]: startTagInHead,\n        [Tokenizer.END_TAG_TOKEN]: endTagInHead,\n        [Tokenizer.EOF_TOKEN]: tokenInHead\n    },\n    [IN_HEAD_NO_SCRIPT_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenInHeadNoScript,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInHeadNoScript,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n        [Tokenizer.START_TAG_TOKEN]: startTagInHeadNoScript,\n        [Tokenizer.END_TAG_TOKEN]: endTagInHeadNoScript,\n        [Tokenizer.EOF_TOKEN]: tokenInHeadNoScript\n    },\n    [AFTER_HEAD_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenAfterHead,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterHead,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: misplacedDoctype,\n        [Tokenizer.START_TAG_TOKEN]: startTagAfterHead,\n        [Tokenizer.END_TAG_TOKEN]: endTagAfterHead,\n        [Tokenizer.EOF_TOKEN]: tokenAfterHead\n    },\n    [IN_BODY_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInBody,\n        [Tokenizer.END_TAG_TOKEN]: endTagInBody,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [TEXT_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: ignoreToken,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: ignoreToken,\n        [Tokenizer.END_TAG_TOKEN]: endTagInText,\n        [Tokenizer.EOF_TOKEN]: eofInText\n    },\n    [IN_TABLE_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInTable,\n        [Tokenizer.END_TAG_TOKEN]: endTagInTable,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_TABLE_TEXT_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInTableText,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInTableText,\n        [Tokenizer.COMMENT_TOKEN]: tokenInTableText,\n        [Tokenizer.DOCTYPE_TOKEN]: tokenInTableText,\n        [Tokenizer.START_TAG_TOKEN]: tokenInTableText,\n        [Tokenizer.END_TAG_TOKEN]: tokenInTableText,\n        [Tokenizer.EOF_TOKEN]: tokenInTableText\n    },\n    [IN_CAPTION_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInCaption,\n        [Tokenizer.END_TAG_TOKEN]: endTagInCaption,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_COLUMN_GROUP_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenInColumnGroup,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenInColumnGroup,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInColumnGroup,\n        [Tokenizer.END_TAG_TOKEN]: endTagInColumnGroup,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_TABLE_BODY_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInTableBody,\n        [Tokenizer.END_TAG_TOKEN]: endTagInTableBody,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_ROW_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: characterInTable,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInRow,\n        [Tokenizer.END_TAG_TOKEN]: endTagInRow,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_CELL_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInCell,\n        [Tokenizer.END_TAG_TOKEN]: endTagInCell,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_SELECT_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInSelect,\n        [Tokenizer.END_TAG_TOKEN]: endTagInSelect,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_SELECT_IN_TABLE_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInSelectInTable,\n        [Tokenizer.END_TAG_TOKEN]: endTagInSelectInTable,\n        [Tokenizer.EOF_TOKEN]: eofInBody\n    },\n    [IN_TEMPLATE_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: characterInBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInTemplate,\n        [Tokenizer.END_TAG_TOKEN]: endTagInTemplate,\n        [Tokenizer.EOF_TOKEN]: eofInTemplate\n    },\n    [AFTER_BODY_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenAfterBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterBody,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendCommentToRootHtmlElement,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagAfterBody,\n        [Tokenizer.END_TAG_TOKEN]: endTagAfterBody,\n        [Tokenizer.EOF_TOKEN]: stopParsing\n    },\n    [IN_FRAMESET_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagInFrameset,\n        [Tokenizer.END_TAG_TOKEN]: endTagInFrameset,\n        [Tokenizer.EOF_TOKEN]: stopParsing\n    },\n    [AFTER_FRAMESET_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: insertCharacters,\n        [Tokenizer.COMMENT_TOKEN]: appendComment,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagAfterFrameset,\n        [Tokenizer.END_TAG_TOKEN]: endTagAfterFrameset,\n        [Tokenizer.EOF_TOKEN]: stopParsing\n    },\n    [AFTER_AFTER_BODY_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: tokenAfterAfterBody,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: tokenAfterAfterBody,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendCommentToDocument,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagAfterAfterBody,\n        [Tokenizer.END_TAG_TOKEN]: tokenAfterAfterBody,\n        [Tokenizer.EOF_TOKEN]: stopParsing\n    },\n    [AFTER_AFTER_FRAMESET_MODE]: {\n        [Tokenizer.CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.NULL_CHARACTER_TOKEN]: ignoreToken,\n        [Tokenizer.WHITESPACE_CHARACTER_TOKEN]: whitespaceCharacterInBody,\n        [Tokenizer.COMMENT_TOKEN]: appendCommentToDocument,\n        [Tokenizer.DOCTYPE_TOKEN]: ignoreToken,\n        [Tokenizer.START_TAG_TOKEN]: startTagAfterAfterFrameset,\n        [Tokenizer.END_TAG_TOKEN]: ignoreToken,\n        [Tokenizer.EOF_TOKEN]: stopParsing\n    }\n};\n\n//Parser\nclass Parser {\n    constructor(options) {\n        this.options = mergeOptions(DEFAULT_OPTIONS, options);\n\n        this.treeAdapter = this.options.treeAdapter;\n        this.pendingScript = null;\n\n        if (this.options.sourceCodeLocationInfo) {\n            Mixin.install(this, LocationInfoParserMixin);\n        }\n\n        if (this.options.onParseError) {\n            Mixin.install(this, ErrorReportingParserMixin, { onParseError: this.options.onParseError });\n        }\n    }\n\n    // API\n    parse(html) {\n        const document = this.treeAdapter.createDocument();\n\n        this._bootstrap(document, null);\n        this.tokenizer.write(html, true);\n        this._runParsingLoop(null);\n\n        return document;\n    }\n\n    parseFragment(html, fragmentContext) {\n        //NOTE: use <template> element as a fragment context if context element was not provided,\n        //so we will parse in \"forgiving\" manner\n        if (!fragmentContext) {\n            fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []);\n        }\n\n        //NOTE: create fake element which will be used as 'document' for fragment parsing.\n        //This is important for jsdom there 'document' can't be recreated, therefore\n        //fragment parsing causes messing of the main `document`.\n        const documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\n\n        this._bootstrap(documentMock, fragmentContext);\n\n        if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE) {\n            this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n        }\n\n        this._initTokenizerForFragmentParsing();\n        this._insertFakeRootElement();\n        this._resetInsertionMode();\n        this._findFormInFragmentContext();\n        this.tokenizer.write(html, true);\n        this._runParsingLoop(null);\n\n        const rootElement = this.treeAdapter.getFirstChild(documentMock);\n        const fragment = this.treeAdapter.createDocumentFragment();\n\n        this._adoptNodes(rootElement, fragment);\n\n        return fragment;\n    }\n\n    //Bootstrap parser\n    _bootstrap(document, fragmentContext) {\n        this.tokenizer = new Tokenizer(this.options);\n\n        this.stopped = false;\n\n        this.insertionMode = INITIAL_MODE;\n        this.originalInsertionMode = '';\n\n        this.document = document;\n        this.fragmentContext = fragmentContext;\n\n        this.headElement = null;\n        this.formElement = null;\n\n        this.openElements = new OpenElementStack(this.document, this.treeAdapter);\n        this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n\n        this.tmplInsertionModeStack = [];\n        this.tmplInsertionModeStackTop = -1;\n        this.currentTmplInsertionMode = null;\n\n        this.pendingCharacterTokens = [];\n        this.hasNonWhitespacePendingCharacterToken = false;\n\n        this.framesetOk = true;\n        this.skipNextNewLine = false;\n        this.fosterParentingEnabled = false;\n    }\n\n    //Errors\n    _err() {\n        // NOTE: err reporting is noop by default. Enabled by mixin.\n    }\n\n    //Parsing loop\n    _runParsingLoop(scriptHandler) {\n        while (!this.stopped) {\n            this._setupTokenizerCDATAMode();\n\n            const token = this.tokenizer.getNextToken();\n\n            if (token.type === Tokenizer.HIBERNATION_TOKEN) {\n                break;\n            }\n\n            if (this.skipNextNewLine) {\n                this.skipNextNewLine = false;\n\n                if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\n                    if (token.chars.length === 1) {\n                        continue;\n                    }\n\n                    token.chars = token.chars.substr(1);\n                }\n            }\n\n            this._processInputToken(token);\n\n            if (scriptHandler && this.pendingScript) {\n                break;\n            }\n        }\n    }\n\n    runParsingLoopForCurrentChunk(writeCallback, scriptHandler) {\n        this._runParsingLoop(scriptHandler);\n\n        if (scriptHandler && this.pendingScript) {\n            const script = this.pendingScript;\n\n            this.pendingScript = null;\n\n            scriptHandler(script);\n\n            return;\n        }\n\n        if (writeCallback) {\n            writeCallback();\n        }\n    }\n\n    //Text parsing\n    _setupTokenizerCDATAMode() {\n        const current = this._getAdjustedCurrentElement();\n\n        this.tokenizer.allowCDATA =\n            current &&\n            current !== this.document &&\n            this.treeAdapter.getNamespaceURI(current) !== NS.HTML &&\n            !this._isIntegrationPoint(current);\n    }\n\n    _switchToTextParsing(currentToken, nextTokenizerState) {\n        this._insertElement(currentToken, NS.HTML);\n        this.tokenizer.state = nextTokenizerState;\n        this.originalInsertionMode = this.insertionMode;\n        this.insertionMode = TEXT_MODE;\n    }\n\n    switchToPlaintextParsing() {\n        this.insertionMode = TEXT_MODE;\n        this.originalInsertionMode = IN_BODY_MODE;\n        this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n    }\n\n    //Fragment parsing\n    _getAdjustedCurrentElement() {\n        return this.openElements.stackTop === 0 && this.fragmentContext\n            ? this.fragmentContext\n            : this.openElements.current;\n    }\n\n    _findFormInFragmentContext() {\n        let node = this.fragmentContext;\n\n        do {\n            if (this.treeAdapter.getTagName(node) === $.FORM) {\n                this.formElement = node;\n                break;\n            }\n\n            node = this.treeAdapter.getParentNode(node);\n        } while (node);\n    }\n\n    _initTokenizerForFragmentParsing() {\n        if (this.treeAdapter.getNamespaceURI(this.fragmentContext) === NS.HTML) {\n            const tn = this.treeAdapter.getTagName(this.fragmentContext);\n\n            if (tn === $.TITLE || tn === $.TEXTAREA) {\n                this.tokenizer.state = Tokenizer.MODE.RCDATA;\n            } else if (\n                tn === $.STYLE ||\n                tn === $.XMP ||\n                tn === $.IFRAME ||\n                tn === $.NOEMBED ||\n                tn === $.NOFRAMES ||\n                tn === $.NOSCRIPT\n            ) {\n                this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\n            } else if (tn === $.SCRIPT) {\n                this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;\n            } else if (tn === $.PLAINTEXT) {\n                this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n            }\n        }\n    }\n\n    //Tree mutation\n    _setDocumentType(token) {\n        const name = token.name || '';\n        const publicId = token.publicId || '';\n        const systemId = token.systemId || '';\n\n        this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n    }\n\n    _attachElementToTree(element) {\n        if (this._shouldFosterParentOnInsertion()) {\n            this._fosterParentElement(element);\n        } else {\n            const parent = this.openElements.currentTmplContent || this.openElements.current;\n\n            this.treeAdapter.appendChild(parent, element);\n        }\n    }\n\n    _appendElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n        this._attachElementToTree(element);\n    }\n\n    _insertElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n        this._attachElementToTree(element);\n        this.openElements.push(element);\n    }\n\n    _insertFakeElement(tagName) {\n        const element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n\n        this._attachElementToTree(element);\n        this.openElements.push(element);\n    }\n\n    _insertTemplate(token) {\n        const tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs);\n        const content = this.treeAdapter.createDocumentFragment();\n\n        this.treeAdapter.setTemplateContent(tmpl, content);\n        this._attachElementToTree(tmpl);\n        this.openElements.push(tmpl);\n    }\n\n    _insertFakeRootElement() {\n        const element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\n\n        this.treeAdapter.appendChild(this.openElements.current, element);\n        this.openElements.push(element);\n    }\n\n    _appendCommentNode(token, parent) {\n        const commentNode = this.treeAdapter.createCommentNode(token.data);\n\n        this.treeAdapter.appendChild(parent, commentNode);\n    }\n\n    _insertCharacters(token) {\n        if (this._shouldFosterParentOnInsertion()) {\n            this._fosterParentText(token.chars);\n        } else {\n            const parent = this.openElements.currentTmplContent || this.openElements.current;\n\n            this.treeAdapter.insertText(parent, token.chars);\n        }\n    }\n\n    _adoptNodes(donor, recipient) {\n        for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n            this.treeAdapter.detachNode(child);\n            this.treeAdapter.appendChild(recipient, child);\n        }\n    }\n\n    //Token processing\n    _shouldProcessTokenInForeignContent(token) {\n        const current = this._getAdjustedCurrentElement();\n\n        if (!current || current === this.document) {\n            return false;\n        }\n\n        const ns = this.treeAdapter.getNamespaceURI(current);\n\n        if (ns === NS.HTML) {\n            return false;\n        }\n\n        if (\n            this.treeAdapter.getTagName(current) === $.ANNOTATION_XML &&\n            ns === NS.MATHML &&\n            token.type === Tokenizer.START_TAG_TOKEN &&\n            token.tagName === $.SVG\n        ) {\n            return false;\n        }\n\n        const isCharacterToken =\n            token.type === Tokenizer.CHARACTER_TOKEN ||\n            token.type === Tokenizer.NULL_CHARACTER_TOKEN ||\n            token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN;\n\n        const isMathMLTextStartTag =\n            token.type === Tokenizer.START_TAG_TOKEN && token.tagName !== $.MGLYPH && token.tagName !== $.MALIGNMARK;\n\n        if ((isMathMLTextStartTag || isCharacterToken) && this._isIntegrationPoint(current, NS.MATHML)) {\n            return false;\n        }\n\n        if (\n            (token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) &&\n            this._isIntegrationPoint(current, NS.HTML)\n        ) {\n            return false;\n        }\n\n        return token.type !== Tokenizer.EOF_TOKEN;\n    }\n\n    _processToken(token) {\n        TOKEN_HANDLERS[this.insertionMode][token.type](this, token);\n    }\n\n    _processTokenInBodyMode(token) {\n        TOKEN_HANDLERS[IN_BODY_MODE][token.type](this, token);\n    }\n\n    _processTokenInForeignContent(token) {\n        if (token.type === Tokenizer.CHARACTER_TOKEN) {\n            characterInForeignContent(this, token);\n        } else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN) {\n            nullCharacterInForeignContent(this, token);\n        } else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN) {\n            insertCharacters(this, token);\n        } else if (token.type === Tokenizer.COMMENT_TOKEN) {\n            appendComment(this, token);\n        } else if (token.type === Tokenizer.START_TAG_TOKEN) {\n            startTagInForeignContent(this, token);\n        } else if (token.type === Tokenizer.END_TAG_TOKEN) {\n            endTagInForeignContent(this, token);\n        }\n    }\n\n    _processInputToken(token) {\n        if (this._shouldProcessTokenInForeignContent(token)) {\n            this._processTokenInForeignContent(token);\n        } else {\n            this._processToken(token);\n        }\n\n        if (token.type === Tokenizer.START_TAG_TOKEN && token.selfClosing && !token.ackSelfClosing) {\n            this._err(ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n        }\n    }\n\n    //Integration points\n    _isIntegrationPoint(element, foreignNS) {\n        const tn = this.treeAdapter.getTagName(element);\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        const attrs = this.treeAdapter.getAttrList(element);\n\n        return foreignContent.isIntegrationPoint(tn, ns, attrs, foreignNS);\n    }\n\n    //Active formatting elements reconstruction\n    _reconstructActiveFormattingElements() {\n        const listLength = this.activeFormattingElements.length;\n\n        if (listLength) {\n            let unopenIdx = listLength;\n            let entry = null;\n\n            do {\n                unopenIdx--;\n                entry = this.activeFormattingElements.entries[unopenIdx];\n\n                if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\n                    unopenIdx++;\n                    break;\n                }\n            } while (unopenIdx > 0);\n\n            for (let i = unopenIdx; i < listLength; i++) {\n                entry = this.activeFormattingElements.entries[i];\n                this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n                entry.element = this.openElements.current;\n            }\n        }\n    }\n\n    //Close elements\n    _closeTableCell() {\n        this.openElements.generateImpliedEndTags();\n        this.openElements.popUntilTableCellPopped();\n        this.activeFormattingElements.clearToLastMarker();\n        this.insertionMode = IN_ROW_MODE;\n    }\n\n    _closePElement() {\n        this.openElements.generateImpliedEndTagsWithExclusion($.P);\n        this.openElements.popUntilTagNamePopped($.P);\n    }\n\n    //Insertion modes\n    _resetInsertionMode() {\n        for (let i = this.openElements.stackTop, last = false; i >= 0; i--) {\n            let element = this.openElements.items[i];\n\n            if (i === 0) {\n                last = true;\n\n                if (this.fragmentContext) {\n                    element = this.fragmentContext;\n                }\n            }\n\n            const tn = this.treeAdapter.getTagName(element);\n            const newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\n\n            if (newInsertionMode) {\n                this.insertionMode = newInsertionMode;\n                break;\n            } else if (!last && (tn === $.TD || tn === $.TH)) {\n                this.insertionMode = IN_CELL_MODE;\n                break;\n            } else if (!last && tn === $.HEAD) {\n                this.insertionMode = IN_HEAD_MODE;\n                break;\n            } else if (tn === $.SELECT) {\n                this._resetInsertionModeForSelect(i);\n                break;\n            } else if (tn === $.TEMPLATE) {\n                this.insertionMode = this.currentTmplInsertionMode;\n                break;\n            } else if (tn === $.HTML) {\n                this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\n                break;\n            } else if (last) {\n                this.insertionMode = IN_BODY_MODE;\n                break;\n            }\n        }\n    }\n\n    _resetInsertionModeForSelect(selectIdx) {\n        if (selectIdx > 0) {\n            for (let i = selectIdx - 1; i > 0; i--) {\n                const ancestor = this.openElements.items[i];\n                const tn = this.treeAdapter.getTagName(ancestor);\n\n                if (tn === $.TEMPLATE) {\n                    break;\n                } else if (tn === $.TABLE) {\n                    this.insertionMode = IN_SELECT_IN_TABLE_MODE;\n                    return;\n                }\n            }\n        }\n\n        this.insertionMode = IN_SELECT_MODE;\n    }\n\n    _pushTmplInsertionMode(mode) {\n        this.tmplInsertionModeStack.push(mode);\n        this.tmplInsertionModeStackTop++;\n        this.currentTmplInsertionMode = mode;\n    }\n\n    _popTmplInsertionMode() {\n        this.tmplInsertionModeStack.pop();\n        this.tmplInsertionModeStackTop--;\n        this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\n    }\n\n    //Foster parenting\n    _isElementCausesFosterParenting(element) {\n        const tn = this.treeAdapter.getTagName(element);\n\n        return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR;\n    }\n\n    _shouldFosterParentOnInsertion() {\n        return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\n    }\n\n    _findFosterParentingLocation() {\n        const location = {\n            parent: null,\n            beforeElement: null\n        };\n\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            const openElement = this.openElements.items[i];\n            const tn = this.treeAdapter.getTagName(openElement);\n            const ns = this.treeAdapter.getNamespaceURI(openElement);\n\n            if (tn === $.TEMPLATE && ns === NS.HTML) {\n                location.parent = this.treeAdapter.getTemplateContent(openElement);\n                break;\n            } else if (tn === $.TABLE) {\n                location.parent = this.treeAdapter.getParentNode(openElement);\n\n                if (location.parent) {\n                    location.beforeElement = openElement;\n                } else {\n                    location.parent = this.openElements.items[i - 1];\n                }\n\n                break;\n            }\n        }\n\n        if (!location.parent) {\n            location.parent = this.openElements.items[0];\n        }\n\n        return location;\n    }\n\n    _fosterParentElement(element) {\n        const location = this._findFosterParentingLocation();\n\n        if (location.beforeElement) {\n            this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n        } else {\n            this.treeAdapter.appendChild(location.parent, element);\n        }\n    }\n\n    _fosterParentText(chars) {\n        const location = this._findFosterParentingLocation();\n\n        if (location.beforeElement) {\n            this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);\n        } else {\n            this.treeAdapter.insertText(location.parent, chars);\n        }\n    }\n\n    //Special elements\n    _isSpecialElement(element) {\n        const tn = this.treeAdapter.getTagName(element);\n        const ns = this.treeAdapter.getNamespaceURI(element);\n\n        return HTML.SPECIAL_ELEMENTS[ns][tn];\n    }\n}\n\nmodule.exports = Parser;\n\n//Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n\n//Steps 5-8 of the algorithm\nfunction aaObtainFormattingElementEntry(p, token) {\n    let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n\n    if (formattingElementEntry) {\n        if (!p.openElements.contains(formattingElementEntry.element)) {\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\n            formattingElementEntry = null;\n        } else if (!p.openElements.hasInScope(token.tagName)) {\n            formattingElementEntry = null;\n        }\n    } else {\n        genericEndTagInBody(p, token);\n    }\n\n    return formattingElementEntry;\n}\n\n//Steps 9 and 10 of the algorithm\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n    let furthestBlock = null;\n\n    for (let i = p.openElements.stackTop; i >= 0; i--) {\n        const element = p.openElements.items[i];\n\n        if (element === formattingElementEntry.element) {\n            break;\n        }\n\n        if (p._isSpecialElement(element)) {\n            furthestBlock = element;\n        }\n    }\n\n    if (!furthestBlock) {\n        p.openElements.popUntilElementPopped(formattingElementEntry.element);\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\n    }\n\n    return furthestBlock;\n}\n\n//Step 13 of the algorithm\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n    let lastElement = furthestBlock;\n    let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n\n    for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n        //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n        nextElement = p.openElements.getCommonAncestor(element);\n\n        const elementEntry = p.activeFormattingElements.getElementEntry(element);\n        const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n        const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n\n        if (shouldRemoveFromOpenElements) {\n            if (counterOverflow) {\n                p.activeFormattingElements.removeEntry(elementEntry);\n            }\n\n            p.openElements.remove(element);\n        } else {\n            element = aaRecreateElementFromEntry(p, elementEntry);\n\n            if (lastElement === furthestBlock) {\n                p.activeFormattingElements.bookmark = elementEntry;\n            }\n\n            p.treeAdapter.detachNode(lastElement);\n            p.treeAdapter.appendChild(element, lastElement);\n            lastElement = element;\n        }\n    }\n\n    return lastElement;\n}\n\n//Step 13.7 of the algorithm\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n    const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n\n    p.openElements.replace(elementEntry.element, newElement);\n    elementEntry.element = newElement;\n\n    return newElement;\n}\n\n//Step 14 of the algorithm\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n    if (p._isElementCausesFosterParenting(commonAncestor)) {\n        p._fosterParentElement(lastElement);\n    } else {\n        const tn = p.treeAdapter.getTagName(commonAncestor);\n        const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n\n        if (tn === $.TEMPLATE && ns === NS.HTML) {\n            commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n        }\n\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\n    }\n}\n\n//Steps 15-19 of the algorithm\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n    const token = formattingElementEntry.token;\n    const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n\n    p._adoptNodes(furthestBlock, newElement);\n    p.treeAdapter.appendChild(furthestBlock, newElement);\n\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n\n    p.openElements.remove(formattingElementEntry.element);\n    p.openElements.insertAfter(furthestBlock, newElement);\n}\n\n//Algorithm entry point\nfunction callAdoptionAgency(p, token) {\n    let formattingElementEntry;\n\n    for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n        formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\n\n        if (!formattingElementEntry) {\n            break;\n        }\n\n        const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n\n        if (!furthestBlock) {\n            break;\n        }\n\n        p.activeFormattingElements.bookmark = formattingElementEntry;\n\n        const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n        const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n\n        p.treeAdapter.detachNode(lastElement);\n        aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n    }\n}\n\n//Generic token handlers\n//------------------------------------------------------------------\nfunction ignoreToken() {\n    //NOTE: do nothing =)\n}\n\nfunction misplacedDoctype(p) {\n    p._err(ERR.misplacedDoctype);\n}\n\nfunction appendComment(p, token) {\n    p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current);\n}\n\nfunction appendCommentToRootHtmlElement(p, token) {\n    p._appendCommentNode(token, p.openElements.items[0]);\n}\n\nfunction appendCommentToDocument(p, token) {\n    p._appendCommentNode(token, p.document);\n}\n\nfunction insertCharacters(p, token) {\n    p._insertCharacters(token);\n}\n\nfunction stopParsing(p) {\n    p.stopped = true;\n}\n\n// The \"initial\" insertion mode\n//------------------------------------------------------------------\nfunction doctypeInInitialMode(p, token) {\n    p._setDocumentType(token);\n\n    const mode = token.forceQuirks ? HTML.DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n\n    if (!doctype.isConforming(token)) {\n        p._err(ERR.nonConformingDoctype);\n    }\n\n    p.treeAdapter.setDocumentMode(p.document, mode);\n\n    p.insertionMode = BEFORE_HTML_MODE;\n}\n\nfunction tokenInInitialMode(p, token) {\n    p._err(ERR.missingDoctype, { beforeToken: true });\n    p.treeAdapter.setDocumentMode(p.document, HTML.DOCUMENT_MODE.QUIRKS);\n    p.insertionMode = BEFORE_HTML_MODE;\n    p._processToken(token);\n}\n\n// The \"before html\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHtml(p, token) {\n    if (token.tagName === $.HTML) {\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = BEFORE_HEAD_MODE;\n    } else {\n        tokenBeforeHtml(p, token);\n    }\n}\n\nfunction endTagBeforeHtml(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) {\n        tokenBeforeHtml(p, token);\n    }\n}\n\nfunction tokenBeforeHtml(p, token) {\n    p._insertFakeRootElement();\n    p.insertionMode = BEFORE_HEAD_MODE;\n    p._processToken(token);\n}\n\n// The \"before head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.HEAD) {\n        p._insertElement(token, NS.HTML);\n        p.headElement = p.openElements.current;\n        p.insertionMode = IN_HEAD_MODE;\n    } else {\n        tokenBeforeHead(p, token);\n    }\n}\n\nfunction endTagBeforeHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) {\n        tokenBeforeHead(p, token);\n    } else {\n        p._err(ERR.endTagWithoutMatchingOpenElement);\n    }\n}\n\nfunction tokenBeforeHead(p, token) {\n    p._insertFakeElement($.HEAD);\n    p.headElement = p.openElements.current;\n    p.insertionMode = IN_HEAD_MODE;\n    p._processToken(token);\n}\n\n// The \"in head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META) {\n        p._appendElement(token, NS.HTML);\n        token.ackSelfClosing = true;\n    } else if (tn === $.TITLE) {\n        p._switchToTextParsing(token, Tokenizer.MODE.RCDATA);\n    } else if (tn === $.NOSCRIPT) {\n        if (p.options.scriptingEnabled) {\n            p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n        } else {\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = IN_HEAD_NO_SCRIPT_MODE;\n        }\n    } else if (tn === $.NOFRAMES || tn === $.STYLE) {\n        p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n    } else if (tn === $.SCRIPT) {\n        p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);\n    } else if (tn === $.TEMPLATE) {\n        p._insertTemplate(token, NS.HTML);\n        p.activeFormattingElements.insertMarker();\n        p.framesetOk = false;\n        p.insertionMode = IN_TEMPLATE_MODE;\n        p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n    } else if (tn === $.HEAD) {\n        p._err(ERR.misplacedStartTagForHeadElement);\n    } else {\n        tokenInHead(p, token);\n    }\n}\n\nfunction endTagInHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HEAD) {\n        p.openElements.pop();\n        p.insertionMode = AFTER_HEAD_MODE;\n    } else if (tn === $.BODY || tn === $.BR || tn === $.HTML) {\n        tokenInHead(p, token);\n    } else if (tn === $.TEMPLATE) {\n        if (p.openElements.tmplCount > 0) {\n            p.openElements.generateImpliedEndTagsThoroughly();\n\n            if (p.openElements.currentTagName !== $.TEMPLATE) {\n                p._err(ERR.closingOfElementWithOpenChildElements);\n            }\n\n            p.openElements.popUntilTagNamePopped($.TEMPLATE);\n            p.activeFormattingElements.clearToLastMarker();\n            p._popTmplInsertionMode();\n            p._resetInsertionMode();\n        } else {\n            p._err(ERR.endTagWithoutMatchingOpenElement);\n        }\n    } else {\n        p._err(ERR.endTagWithoutMatchingOpenElement);\n    }\n}\n\nfunction tokenInHead(p, token) {\n    p.openElements.pop();\n    p.insertionMode = AFTER_HEAD_MODE;\n    p._processToken(token);\n}\n\n// The \"in head no script\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHeadNoScript(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (\n        tn === $.BASEFONT ||\n        tn === $.BGSOUND ||\n        tn === $.HEAD ||\n        tn === $.LINK ||\n        tn === $.META ||\n        tn === $.NOFRAMES ||\n        tn === $.STYLE\n    ) {\n        startTagInHead(p, token);\n    } else if (tn === $.NOSCRIPT) {\n        p._err(ERR.nestedNoscriptInHead);\n    } else {\n        tokenInHeadNoScript(p, token);\n    }\n}\n\nfunction endTagInHeadNoScript(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.NOSCRIPT) {\n        p.openElements.pop();\n        p.insertionMode = IN_HEAD_MODE;\n    } else if (tn === $.BR) {\n        tokenInHeadNoScript(p, token);\n    } else {\n        p._err(ERR.endTagWithoutMatchingOpenElement);\n    }\n}\n\nfunction tokenInHeadNoScript(p, token) {\n    const errCode =\n        token.type === Tokenizer.EOF_TOKEN ? ERR.openElementsLeftAfterEof : ERR.disallowedContentInNoscriptInHead;\n\n    p._err(errCode);\n    p.openElements.pop();\n    p.insertionMode = IN_HEAD_MODE;\n    p._processToken(token);\n}\n\n// The \"after head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.BODY) {\n        p._insertElement(token, NS.HTML);\n        p.framesetOk = false;\n        p.insertionMode = IN_BODY_MODE;\n    } else if (tn === $.FRAMESET) {\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = IN_FRAMESET_MODE;\n    } else if (\n        tn === $.BASE ||\n        tn === $.BASEFONT ||\n        tn === $.BGSOUND ||\n        tn === $.LINK ||\n        tn === $.META ||\n        tn === $.NOFRAMES ||\n        tn === $.SCRIPT ||\n        tn === $.STYLE ||\n        tn === $.TEMPLATE ||\n        tn === $.TITLE\n    ) {\n        p._err(ERR.abandonedHeadElementChild);\n        p.openElements.push(p.headElement);\n        startTagInHead(p, token);\n        p.openElements.remove(p.headElement);\n    } else if (tn === $.HEAD) {\n        p._err(ERR.misplacedStartTagForHeadElement);\n    } else {\n        tokenAfterHead(p, token);\n    }\n}\n\nfunction endTagAfterHead(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.BODY || tn === $.HTML || tn === $.BR) {\n        tokenAfterHead(p, token);\n    } else if (tn === $.TEMPLATE) {\n        endTagInHead(p, token);\n    } else {\n        p._err(ERR.endTagWithoutMatchingOpenElement);\n    }\n}\n\nfunction tokenAfterHead(p, token) {\n    p._insertFakeElement($.BODY);\n    p.insertionMode = IN_BODY_MODE;\n    p._processToken(token);\n}\n\n// The \"in body\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n}\n\nfunction characterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\n\nfunction htmlStartTagInBody(p, token) {\n    if (p.openElements.tmplCount === 0) {\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n    }\n}\n\nfunction bodyStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n    if (bodyElement && p.openElements.tmplCount === 0) {\n        p.framesetOk = false;\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n    }\n}\n\nfunction framesetStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n    if (p.framesetOk && bodyElement) {\n        p.treeAdapter.detachNode(bodyElement);\n        p.openElements.popAllUpToHtmlElement();\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = IN_FRAMESET_MODE;\n    }\n}\n\nfunction addressStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction numberedHeaderStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    const tn = p.openElements.currentTagName;\n\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n        p.openElements.pop();\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction preStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.framesetOk = false;\n}\n\nfunction formStartTagInBody(p, token) {\n    const inTemplate = p.openElements.tmplCount > 0;\n\n    if (!p.formElement || inTemplate) {\n        if (p.openElements.hasInButtonScope($.P)) {\n            p._closePElement();\n        }\n\n        p._insertElement(token, NS.HTML);\n\n        if (!inTemplate) {\n            p.formElement = p.openElements.current;\n        }\n    }\n}\n\nfunction listItemStartTagInBody(p, token) {\n    p.framesetOk = false;\n\n    const tn = token.tagName;\n\n    for (let i = p.openElements.stackTop; i >= 0; i--) {\n        const element = p.openElements.items[i];\n        const elementTn = p.treeAdapter.getTagName(element);\n        let closeTn = null;\n\n        if (tn === $.LI && elementTn === $.LI) {\n            closeTn = $.LI;\n        } else if ((tn === $.DD || tn === $.DT) && (elementTn === $.DD || elementTn === $.DT)) {\n            closeTn = elementTn;\n        }\n\n        if (closeTn) {\n            p.openElements.generateImpliedEndTagsWithExclusion(closeTn);\n            p.openElements.popUntilTagNamePopped(closeTn);\n            break;\n        }\n\n        if (elementTn !== $.ADDRESS && elementTn !== $.DIV && elementTn !== $.P && p._isSpecialElement(element)) {\n            break;\n        }\n    }\n\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction plaintextStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n    p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}\n\nfunction buttonStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BUTTON)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped($.BUTTON);\n    }\n\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n}\n\nfunction aStartTagInBody(p, token) {\n    const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\n\n    if (activeElementEntry) {\n        callAdoptionAgency(p, token);\n        p.openElements.remove(activeElementEntry.element);\n        p.activeFormattingElements.removeEntry(activeElementEntry);\n    }\n\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction bStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction nobrStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n\n    if (p.openElements.hasInScope($.NOBR)) {\n        callAdoptionAgency(p, token);\n        p._reconstructActiveFormattingElements();\n    }\n\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction appletStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.insertMarker();\n    p.framesetOk = false;\n}\n\nfunction tableStartTagInBody(p, token) {\n    if (\n        p.treeAdapter.getDocumentMode(p.document) !== HTML.DOCUMENT_MODE.QUIRKS &&\n        p.openElements.hasInButtonScope($.P)\n    ) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode = IN_TABLE_MODE;\n}\n\nfunction areaStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\n\nfunction inputStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n\n    const inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n\n    if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE) {\n        p.framesetOk = false;\n    }\n\n    token.ackSelfClosing = true;\n}\n\nfunction paramStartTagInBody(p, token) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n}\n\nfunction hrStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\n\nfunction imageStartTagInBody(p, token) {\n    token.tagName = $.IMG;\n    areaStartTagInBody(p, token);\n}\n\nfunction textareaStartTagInBody(p, token) {\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.tokenizer.state = Tokenizer.MODE.RCDATA;\n    p.originalInsertionMode = p.insertionMode;\n    p.framesetOk = false;\n    p.insertionMode = TEXT_MODE;\n}\n\nfunction xmpStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._reconstructActiveFormattingElements();\n    p.framesetOk = false;\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction iframeStartTagInBody(p, token) {\n    p.framesetOk = false;\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as a rawtext.\nfunction noembedStartTagInBody(p, token) {\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction selectStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n\n    if (\n        p.insertionMode === IN_TABLE_MODE ||\n        p.insertionMode === IN_CAPTION_MODE ||\n        p.insertionMode === IN_TABLE_BODY_MODE ||\n        p.insertionMode === IN_ROW_MODE ||\n        p.insertionMode === IN_CELL_MODE\n    ) {\n        p.insertionMode = IN_SELECT_IN_TABLE_MODE;\n    } else {\n        p.insertionMode = IN_SELECT_MODE;\n    }\n}\n\nfunction optgroupStartTagInBody(p, token) {\n    if (p.openElements.currentTagName === $.OPTION) {\n        p.openElements.pop();\n    }\n\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\n\nfunction rbStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTags();\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction rtStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction menuStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n}\n\nfunction mathStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n\n    foreignContent.adjustTokenMathMLAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n\n    if (token.selfClosing) {\n        p._appendElement(token, NS.MATHML);\n    } else {\n        p._insertElement(token, NS.MATHML);\n    }\n\n    token.ackSelfClosing = true;\n}\n\nfunction svgStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n\n    foreignContent.adjustTokenSVGAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n\n    if (token.selfClosing) {\n        p._appendElement(token, NS.SVG);\n    } else {\n        p._insertElement(token, NS.SVG);\n    }\n\n    token.ackSelfClosing = true;\n}\n\nfunction genericStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction startTagInBody(p, token) {\n    const tn = token.tagName;\n\n    switch (tn.length) {\n        case 1:\n            if (tn === $.I || tn === $.S || tn === $.B || tn === $.U) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.P) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.A) {\n                aStartTagInBody(p, token);\n            } else {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 2:\n            if (tn === $.DL || tn === $.OL || tn === $.UL) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n                numberedHeaderStartTagInBody(p, token);\n            } else if (tn === $.LI || tn === $.DD || tn === $.DT) {\n                listItemStartTagInBody(p, token);\n            } else if (tn === $.EM || tn === $.TT) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.BR) {\n                areaStartTagInBody(p, token);\n            } else if (tn === $.HR) {\n                hrStartTagInBody(p, token);\n            } else if (tn === $.RB) {\n                rbStartTagInBody(p, token);\n            } else if (tn === $.RT || tn === $.RP) {\n                rtStartTagInBody(p, token);\n            } else if (tn !== $.TH && tn !== $.TD && tn !== $.TR) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 3:\n            if (tn === $.DIV || tn === $.DIR || tn === $.NAV) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.PRE) {\n                preStartTagInBody(p, token);\n            } else if (tn === $.BIG) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.IMG || tn === $.WBR) {\n                areaStartTagInBody(p, token);\n            } else if (tn === $.XMP) {\n                xmpStartTagInBody(p, token);\n            } else if (tn === $.SVG) {\n                svgStartTagInBody(p, token);\n            } else if (tn === $.RTC) {\n                rbStartTagInBody(p, token);\n            } else if (tn !== $.COL) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 4:\n            if (tn === $.HTML) {\n                htmlStartTagInBody(p, token);\n            } else if (tn === $.BASE || tn === $.LINK || tn === $.META) {\n                startTagInHead(p, token);\n            } else if (tn === $.BODY) {\n                bodyStartTagInBody(p, token);\n            } else if (tn === $.MAIN || tn === $.MENU) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.FORM) {\n                formStartTagInBody(p, token);\n            } else if (tn === $.CODE || tn === $.FONT) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.NOBR) {\n                nobrStartTagInBody(p, token);\n            } else if (tn === $.AREA) {\n                areaStartTagInBody(p, token);\n            } else if (tn === $.MATH) {\n                mathStartTagInBody(p, token);\n            } else if (tn === $.MENU) {\n                menuStartTagInBody(p, token);\n            } else if (tn !== $.HEAD) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 5:\n            if (tn === $.STYLE || tn === $.TITLE) {\n                startTagInHead(p, token);\n            } else if (tn === $.ASIDE) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.SMALL) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.TABLE) {\n                tableStartTagInBody(p, token);\n            } else if (tn === $.EMBED) {\n                areaStartTagInBody(p, token);\n            } else if (tn === $.INPUT) {\n                inputStartTagInBody(p, token);\n            } else if (tn === $.PARAM || tn === $.TRACK) {\n                paramStartTagInBody(p, token);\n            } else if (tn === $.IMAGE) {\n                imageStartTagInBody(p, token);\n            } else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 6:\n            if (tn === $.SCRIPT) {\n                startTagInHead(p, token);\n            } else if (\n                tn === $.CENTER ||\n                tn === $.FIGURE ||\n                tn === $.FOOTER ||\n                tn === $.HEADER ||\n                tn === $.HGROUP ||\n                tn === $.DIALOG\n            ) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.BUTTON) {\n                buttonStartTagInBody(p, token);\n            } else if (tn === $.STRIKE || tn === $.STRONG) {\n                bStartTagInBody(p, token);\n            } else if (tn === $.APPLET || tn === $.OBJECT) {\n                appletStartTagInBody(p, token);\n            } else if (tn === $.KEYGEN) {\n                areaStartTagInBody(p, token);\n            } else if (tn === $.SOURCE) {\n                paramStartTagInBody(p, token);\n            } else if (tn === $.IFRAME) {\n                iframeStartTagInBody(p, token);\n            } else if (tn === $.SELECT) {\n                selectStartTagInBody(p, token);\n            } else if (tn === $.OPTION) {\n                optgroupStartTagInBody(p, token);\n            } else {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 7:\n            if (tn === $.BGSOUND) {\n                startTagInHead(p, token);\n            } else if (\n                tn === $.DETAILS ||\n                tn === $.ADDRESS ||\n                tn === $.ARTICLE ||\n                tn === $.SECTION ||\n                tn === $.SUMMARY\n            ) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.LISTING) {\n                preStartTagInBody(p, token);\n            } else if (tn === $.MARQUEE) {\n                appletStartTagInBody(p, token);\n            } else if (tn === $.NOEMBED) {\n                noembedStartTagInBody(p, token);\n            } else if (tn !== $.CAPTION) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 8:\n            if (tn === $.BASEFONT) {\n                startTagInHead(p, token);\n            } else if (tn === $.FRAMESET) {\n                framesetStartTagInBody(p, token);\n            } else if (tn === $.FIELDSET) {\n                addressStartTagInBody(p, token);\n            } else if (tn === $.TEXTAREA) {\n                textareaStartTagInBody(p, token);\n            } else if (tn === $.TEMPLATE) {\n                startTagInHead(p, token);\n            } else if (tn === $.NOSCRIPT) {\n                if (p.options.scriptingEnabled) {\n                    noembedStartTagInBody(p, token);\n                } else {\n                    genericStartTagInBody(p, token);\n                }\n            } else if (tn === $.OPTGROUP) {\n                optgroupStartTagInBody(p, token);\n            } else if (tn !== $.COLGROUP) {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 9:\n            if (tn === $.PLAINTEXT) {\n                plaintextStartTagInBody(p, token);\n            } else {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        case 10:\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) {\n                addressStartTagInBody(p, token);\n            } else {\n                genericStartTagInBody(p, token);\n            }\n\n            break;\n\n        default:\n            genericStartTagInBody(p, token);\n    }\n}\n\nfunction bodyEndTagInBody(p) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = AFTER_BODY_MODE;\n    }\n}\n\nfunction htmlEndTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = AFTER_BODY_MODE;\n        p._processToken(token);\n    }\n}\n\nfunction addressEndTagInBody(p, token) {\n    const tn = token.tagName;\n\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\n\nfunction formEndTagInBody(p) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    const formElement = p.formElement;\n\n    if (!inTemplate) {\n        p.formElement = null;\n    }\n\n    if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n        p.openElements.generateImpliedEndTags();\n\n        if (inTemplate) {\n            p.openElements.popUntilTagNamePopped($.FORM);\n        } else {\n            p.openElements.remove(formElement);\n        }\n    }\n}\n\nfunction pEndTagInBody(p) {\n    if (!p.openElements.hasInButtonScope($.P)) {\n        p._insertFakeElement($.P);\n    }\n\n    p._closePElement();\n}\n\nfunction liEndTagInBody(p) {\n    if (p.openElements.hasInListItemScope($.LI)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n        p.openElements.popUntilTagNamePopped($.LI);\n    }\n}\n\nfunction ddEndTagInBody(p, token) {\n    const tn = token.tagName;\n\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\n\nfunction numberedHeaderEndTagInBody(p) {\n    if (p.openElements.hasNumberedHeaderInScope()) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilNumberedHeaderPopped();\n    }\n}\n\nfunction appletEndTagInBody(p, token) {\n    const tn = token.tagName;\n\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n        p.activeFormattingElements.clearToLastMarker();\n    }\n}\n\nfunction brEndTagInBody(p) {\n    p._reconstructActiveFormattingElements();\n    p._insertFakeElement($.BR);\n    p.openElements.pop();\n    p.framesetOk = false;\n}\n\nfunction genericEndTagInBody(p, token) {\n    const tn = token.tagName;\n\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n\n        if (p.treeAdapter.getTagName(element) === tn) {\n            p.openElements.generateImpliedEndTagsWithExclusion(tn);\n            p.openElements.popUntilElementPopped(element);\n            break;\n        }\n\n        if (p._isSpecialElement(element)) {\n            break;\n        }\n    }\n}\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction endTagInBody(p, token) {\n    const tn = token.tagName;\n\n    switch (tn.length) {\n        case 1:\n            if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn === $.U) {\n                callAdoptionAgency(p, token);\n            } else if (tn === $.P) {\n                pEndTagInBody(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 2:\n            if (tn === $.DL || tn === $.UL || tn === $.OL) {\n                addressEndTagInBody(p, token);\n            } else if (tn === $.LI) {\n                liEndTagInBody(p, token);\n            } else if (tn === $.DD || tn === $.DT) {\n                ddEndTagInBody(p, token);\n            } else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) {\n                numberedHeaderEndTagInBody(p, token);\n            } else if (tn === $.BR) {\n                brEndTagInBody(p, token);\n            } else if (tn === $.EM || tn === $.TT) {\n                callAdoptionAgency(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 3:\n            if (tn === $.BIG) {\n                callAdoptionAgency(p, token);\n            } else if (tn === $.DIR || tn === $.DIV || tn === $.NAV || tn === $.PRE) {\n                addressEndTagInBody(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 4:\n            if (tn === $.BODY) {\n                bodyEndTagInBody(p, token);\n            } else if (tn === $.HTML) {\n                htmlEndTagInBody(p, token);\n            } else if (tn === $.FORM) {\n                formEndTagInBody(p, token);\n            } else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR) {\n                callAdoptionAgency(p, token);\n            } else if (tn === $.MAIN || tn === $.MENU) {\n                addressEndTagInBody(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 5:\n            if (tn === $.ASIDE) {\n                addressEndTagInBody(p, token);\n            } else if (tn === $.SMALL) {\n                callAdoptionAgency(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 6:\n            if (\n                tn === $.CENTER ||\n                tn === $.FIGURE ||\n                tn === $.FOOTER ||\n                tn === $.HEADER ||\n                tn === $.HGROUP ||\n                tn === $.DIALOG\n            ) {\n                addressEndTagInBody(p, token);\n            } else if (tn === $.APPLET || tn === $.OBJECT) {\n                appletEndTagInBody(p, token);\n            } else if (tn === $.STRIKE || tn === $.STRONG) {\n                callAdoptionAgency(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 7:\n            if (\n                tn === $.ADDRESS ||\n                tn === $.ARTICLE ||\n                tn === $.DETAILS ||\n                tn === $.SECTION ||\n                tn === $.SUMMARY ||\n                tn === $.LISTING\n            ) {\n                addressEndTagInBody(p, token);\n            } else if (tn === $.MARQUEE) {\n                appletEndTagInBody(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 8:\n            if (tn === $.FIELDSET) {\n                addressEndTagInBody(p, token);\n            } else if (tn === $.TEMPLATE) {\n                endTagInHead(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        case 10:\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) {\n                addressEndTagInBody(p, token);\n            } else {\n                genericEndTagInBody(p, token);\n            }\n\n            break;\n\n        default:\n            genericEndTagInBody(p, token);\n    }\n}\n\nfunction eofInBody(p, token) {\n    if (p.tmplInsertionModeStackTop > -1) {\n        eofInTemplate(p, token);\n    } else {\n        p.stopped = true;\n    }\n}\n\n// The \"text\" insertion mode\n//------------------------------------------------------------------\nfunction endTagInText(p, token) {\n    if (token.tagName === $.SCRIPT) {\n        p.pendingScript = p.openElements.current;\n    }\n\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n}\n\nfunction eofInText(p, token) {\n    p._err(ERR.eofInElementThatCanContainOnlyText);\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n    p._processToken(token);\n}\n\n// The \"in table\" insertion mode\n//------------------------------------------------------------------\nfunction characterInTable(p, token) {\n    const curTn = p.openElements.currentTagName;\n\n    if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\n        p.pendingCharacterTokens = [];\n        p.hasNonWhitespacePendingCharacterToken = false;\n        p.originalInsertionMode = p.insertionMode;\n        p.insertionMode = IN_TABLE_TEXT_MODE;\n        p._processToken(token);\n    } else {\n        tokenInTable(p, token);\n    }\n}\n\nfunction captionStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p.activeFormattingElements.insertMarker();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_CAPTION_MODE;\n}\n\nfunction colgroupStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_COLUMN_GROUP_MODE;\n}\n\nfunction colStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement($.COLGROUP);\n    p.insertionMode = IN_COLUMN_GROUP_MODE;\n    p._processToken(token);\n}\n\nfunction tbodyStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = IN_TABLE_BODY_MODE;\n}\n\nfunction tdStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement($.TBODY);\n    p.insertionMode = IN_TABLE_BODY_MODE;\n    p._processToken(token);\n}\n\nfunction tableStartTagInTable(p, token) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n        p.openElements.popUntilTagNamePopped($.TABLE);\n        p._resetInsertionMode();\n        p._processToken(token);\n    }\n}\n\nfunction inputStartTagInTable(p, token) {\n    const inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n\n    if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE) {\n        p._appendElement(token, NS.HTML);\n    } else {\n        tokenInTable(p, token);\n    }\n\n    token.ackSelfClosing = true;\n}\n\nfunction formStartTagInTable(p, token) {\n    if (!p.formElement && p.openElements.tmplCount === 0) {\n        p._insertElement(token, NS.HTML);\n        p.formElement = p.openElements.current;\n        p.openElements.pop();\n    }\n}\n\nfunction startTagInTable(p, token) {\n    const tn = token.tagName;\n\n    switch (tn.length) {\n        case 2:\n            if (tn === $.TD || tn === $.TH || tn === $.TR) {\n                tdStartTagInTable(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 3:\n            if (tn === $.COL) {\n                colStartTagInTable(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 4:\n            if (tn === $.FORM) {\n                formStartTagInTable(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 5:\n            if (tn === $.TABLE) {\n                tableStartTagInTable(p, token);\n            } else if (tn === $.STYLE) {\n                startTagInHead(p, token);\n            } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n                tbodyStartTagInTable(p, token);\n            } else if (tn === $.INPUT) {\n                inputStartTagInTable(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 6:\n            if (tn === $.SCRIPT) {\n                startTagInHead(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 7:\n            if (tn === $.CAPTION) {\n                captionStartTagInTable(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        case 8:\n            if (tn === $.COLGROUP) {\n                colgroupStartTagInTable(p, token);\n            } else if (tn === $.TEMPLATE) {\n                startTagInHead(p, token);\n            } else {\n                tokenInTable(p, token);\n            }\n\n            break;\n\n        default:\n            tokenInTable(p, token);\n    }\n}\n\nfunction endTagInTable(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TABLE) {\n        if (p.openElements.hasInTableScope($.TABLE)) {\n            p.openElements.popUntilTagNamePopped($.TABLE);\n            p._resetInsertionMode();\n        }\n    } else if (tn === $.TEMPLATE) {\n        endTagInHead(p, token);\n    } else if (\n        tn !== $.BODY &&\n        tn !== $.CAPTION &&\n        tn !== $.COL &&\n        tn !== $.COLGROUP &&\n        tn !== $.HTML &&\n        tn !== $.TBODY &&\n        tn !== $.TD &&\n        tn !== $.TFOOT &&\n        tn !== $.TH &&\n        tn !== $.THEAD &&\n        tn !== $.TR\n    ) {\n        tokenInTable(p, token);\n    }\n}\n\nfunction tokenInTable(p, token) {\n    const savedFosterParentingState = p.fosterParentingEnabled;\n\n    p.fosterParentingEnabled = true;\n    p._processTokenInBodyMode(token);\n    p.fosterParentingEnabled = savedFosterParentingState;\n}\n\n// The \"in table text\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n}\n\nfunction characterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n    p.hasNonWhitespacePendingCharacterToken = true;\n}\n\nfunction tokenInTableText(p, token) {\n    let i = 0;\n\n    if (p.hasNonWhitespacePendingCharacterToken) {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            tokenInTable(p, p.pendingCharacterTokens[i]);\n        }\n    } else {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            p._insertCharacters(p.pendingCharacterTokens[i]);\n        }\n    }\n\n    p.insertionMode = p.originalInsertionMode;\n    p._processToken(token);\n}\n\n// The \"in caption\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCaption(p, token) {\n    const tn = token.tagName;\n\n    if (\n        tn === $.CAPTION ||\n        tn === $.COL ||\n        tn === $.COLGROUP ||\n        tn === $.TBODY ||\n        tn === $.TD ||\n        tn === $.TFOOT ||\n        tn === $.TH ||\n        tn === $.THEAD ||\n        tn === $.TR\n    ) {\n        if (p.openElements.hasInTableScope($.CAPTION)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped($.CAPTION);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = IN_TABLE_MODE;\n            p._processToken(token);\n        }\n    } else {\n        startTagInBody(p, token);\n    }\n}\n\nfunction endTagInCaption(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.CAPTION || tn === $.TABLE) {\n        if (p.openElements.hasInTableScope($.CAPTION)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped($.CAPTION);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = IN_TABLE_MODE;\n\n            if (tn === $.TABLE) {\n                p._processToken(token);\n            }\n        }\n    } else if (\n        tn !== $.BODY &&\n        tn !== $.COL &&\n        tn !== $.COLGROUP &&\n        tn !== $.HTML &&\n        tn !== $.TBODY &&\n        tn !== $.TD &&\n        tn !== $.TFOOT &&\n        tn !== $.TH &&\n        tn !== $.THEAD &&\n        tn !== $.TR\n    ) {\n        endTagInBody(p, token);\n    }\n}\n\n// The \"in column group\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInColumnGroup(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.COL) {\n        p._appendElement(token, NS.HTML);\n        token.ackSelfClosing = true;\n    } else if (tn === $.TEMPLATE) {\n        startTagInHead(p, token);\n    } else {\n        tokenInColumnGroup(p, token);\n    }\n}\n\nfunction endTagInColumnGroup(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.COLGROUP) {\n        if (p.openElements.currentTagName === $.COLGROUP) {\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_MODE;\n        }\n    } else if (tn === $.TEMPLATE) {\n        endTagInHead(p, token);\n    } else if (tn !== $.COL) {\n        tokenInColumnGroup(p, token);\n    }\n}\n\nfunction tokenInColumnGroup(p, token) {\n    if (p.openElements.currentTagName === $.COLGROUP) {\n        p.openElements.pop();\n        p.insertionMode = IN_TABLE_MODE;\n        p._processToken(token);\n    }\n}\n\n// The \"in table body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTableBody(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TR) {\n        p.openElements.clearBackToTableBodyContext();\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = IN_ROW_MODE;\n    } else if (tn === $.TH || tn === $.TD) {\n        p.openElements.clearBackToTableBodyContext();\n        p._insertFakeElement($.TR);\n        p.insertionMode = IN_ROW_MODE;\n        p._processToken(token);\n    } else if (\n        tn === $.CAPTION ||\n        tn === $.COL ||\n        tn === $.COLGROUP ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD\n    ) {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n            p.openElements.clearBackToTableBodyContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_MODE;\n            p._processToken(token);\n        }\n    } else {\n        startTagInTable(p, token);\n    }\n}\n\nfunction endTagInTableBody(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.clearBackToTableBodyContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_MODE;\n        }\n    } else if (tn === $.TABLE) {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n            p.openElements.clearBackToTableBodyContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_MODE;\n            p._processToken(token);\n        }\n    } else if (\n        (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP) ||\n        (tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR)\n    ) {\n        endTagInTable(p, token);\n    }\n}\n\n// The \"in row\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInRow(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TH || tn === $.TD) {\n        p.openElements.clearBackToTableRowContext();\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = IN_CELL_MODE;\n        p.activeFormattingElements.insertMarker();\n    } else if (\n        tn === $.CAPTION ||\n        tn === $.COL ||\n        tn === $.COLGROUP ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR\n    ) {\n        if (p.openElements.hasInTableScope($.TR)) {\n            p.openElements.clearBackToTableRowContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_BODY_MODE;\n            p._processToken(token);\n        }\n    } else {\n        startTagInTable(p, token);\n    }\n}\n\nfunction endTagInRow(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TR) {\n        if (p.openElements.hasInTableScope($.TR)) {\n            p.openElements.clearBackToTableRowContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_BODY_MODE;\n        }\n    } else if (tn === $.TABLE) {\n        if (p.openElements.hasInTableScope($.TR)) {\n            p.openElements.clearBackToTableRowContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_BODY_MODE;\n            p._processToken(token);\n        }\n    } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n        if (p.openElements.hasInTableScope(tn) || p.openElements.hasInTableScope($.TR)) {\n            p.openElements.clearBackToTableRowContext();\n            p.openElements.pop();\n            p.insertionMode = IN_TABLE_BODY_MODE;\n            p._processToken(token);\n        }\n    } else if (\n        (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP) ||\n        (tn !== $.HTML && tn !== $.TD && tn !== $.TH)\n    ) {\n        endTagInTable(p, token);\n    }\n}\n\n// The \"in cell\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCell(p, token) {\n    const tn = token.tagName;\n\n    if (\n        tn === $.CAPTION ||\n        tn === $.COL ||\n        tn === $.COLGROUP ||\n        tn === $.TBODY ||\n        tn === $.TD ||\n        tn === $.TFOOT ||\n        tn === $.TH ||\n        tn === $.THEAD ||\n        tn === $.TR\n    ) {\n        if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n            p._closeTableCell();\n            p._processToken(token);\n        }\n    } else {\n        startTagInBody(p, token);\n    }\n}\n\nfunction endTagInCell(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.TD || tn === $.TH) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped(tn);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = IN_ROW_MODE;\n        }\n    } else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p._closeTableCell();\n            p._processToken(token);\n        }\n    } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML) {\n        endTagInBody(p, token);\n    }\n}\n\n// The \"in select\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelect(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.OPTION) {\n        if (p.openElements.currentTagName === $.OPTION) {\n            p.openElements.pop();\n        }\n\n        p._insertElement(token, NS.HTML);\n    } else if (tn === $.OPTGROUP) {\n        if (p.openElements.currentTagName === $.OPTION) {\n            p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagName === $.OPTGROUP) {\n            p.openElements.pop();\n        }\n\n        p._insertElement(token, NS.HTML);\n    } else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA || tn === $.SELECT) {\n        if (p.openElements.hasInSelectScope($.SELECT)) {\n            p.openElements.popUntilTagNamePopped($.SELECT);\n            p._resetInsertionMode();\n\n            if (tn !== $.SELECT) {\n                p._processToken(token);\n            }\n        }\n    } else if (tn === $.SCRIPT || tn === $.TEMPLATE) {\n        startTagInHead(p, token);\n    }\n}\n\nfunction endTagInSelect(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.OPTGROUP) {\n        const prevOpenElement = p.openElements.items[p.openElements.stackTop - 1];\n        const prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\n\n        if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP) {\n            p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagName === $.OPTGROUP) {\n            p.openElements.pop();\n        }\n    } else if (tn === $.OPTION) {\n        if (p.openElements.currentTagName === $.OPTION) {\n            p.openElements.pop();\n        }\n    } else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\n        p.openElements.popUntilTagNamePopped($.SELECT);\n        p._resetInsertionMode();\n    } else if (tn === $.TEMPLATE) {\n        endTagInHead(p, token);\n    }\n}\n\n//12.2.5.4.17 The \"in select in table\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelectInTable(p, token) {\n    const tn = token.tagName;\n\n    if (\n        tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH\n    ) {\n        p.openElements.popUntilTagNamePopped($.SELECT);\n        p._resetInsertionMode();\n        p._processToken(token);\n    } else {\n        startTagInSelect(p, token);\n    }\n}\n\nfunction endTagInSelectInTable(p, token) {\n    const tn = token.tagName;\n\n    if (\n        tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH\n    ) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.popUntilTagNamePopped($.SELECT);\n            p._resetInsertionMode();\n            p._processToken(token);\n        }\n    } else {\n        endTagInSelect(p, token);\n    }\n}\n\n// The \"in template\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTemplate(p, token) {\n    const tn = token.tagName;\n\n    if (\n        tn === $.BASE ||\n        tn === $.BASEFONT ||\n        tn === $.BGSOUND ||\n        tn === $.LINK ||\n        tn === $.META ||\n        tn === $.NOFRAMES ||\n        tn === $.SCRIPT ||\n        tn === $.STYLE ||\n        tn === $.TEMPLATE ||\n        tn === $.TITLE\n    ) {\n        startTagInHead(p, token);\n    } else {\n        const newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\n\n        p._popTmplInsertionMode();\n        p._pushTmplInsertionMode(newInsertionMode);\n        p.insertionMode = newInsertionMode;\n        p._processToken(token);\n    }\n}\n\nfunction endTagInTemplate(p, token) {\n    if (token.tagName === $.TEMPLATE) {\n        endTagInHead(p, token);\n    }\n}\n\nfunction eofInTemplate(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p._popTmplInsertionMode();\n        p._resetInsertionMode();\n        p._processToken(token);\n    } else {\n        p.stopped = true;\n    }\n}\n\n// The \"after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterBody(p, token) {\n    if (token.tagName === $.HTML) {\n        startTagInBody(p, token);\n    } else {\n        tokenAfterBody(p, token);\n    }\n}\n\nfunction endTagAfterBody(p, token) {\n    if (token.tagName === $.HTML) {\n        if (!p.fragmentContext) {\n            p.insertionMode = AFTER_AFTER_BODY_MODE;\n        }\n    } else {\n        tokenAfterBody(p, token);\n    }\n}\n\nfunction tokenAfterBody(p, token) {\n    p.insertionMode = IN_BODY_MODE;\n    p._processToken(token);\n}\n\n// The \"in frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInFrameset(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.FRAMESET) {\n        p._insertElement(token, NS.HTML);\n    } else if (tn === $.FRAME) {\n        p._appendElement(token, NS.HTML);\n        token.ackSelfClosing = true;\n    } else if (tn === $.NOFRAMES) {\n        startTagInHead(p, token);\n    }\n}\n\nfunction endTagInFrameset(p, token) {\n    if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n        p.openElements.pop();\n\n        if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET) {\n            p.insertionMode = AFTER_FRAMESET_MODE;\n        }\n    }\n}\n\n// The \"after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterFrameset(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.NOFRAMES) {\n        startTagInHead(p, token);\n    }\n}\n\nfunction endTagAfterFrameset(p, token) {\n    if (token.tagName === $.HTML) {\n        p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\n    }\n}\n\n// The \"after after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterBody(p, token) {\n    if (token.tagName === $.HTML) {\n        startTagInBody(p, token);\n    } else {\n        tokenAfterAfterBody(p, token);\n    }\n}\n\nfunction tokenAfterAfterBody(p, token) {\n    p.insertionMode = IN_BODY_MODE;\n    p._processToken(token);\n}\n\n// The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterFrameset(p, token) {\n    const tn = token.tagName;\n\n    if (tn === $.HTML) {\n        startTagInBody(p, token);\n    } else if (tn === $.NOFRAMES) {\n        startTagInHead(p, token);\n    }\n}\n\n// The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\nfunction nullCharacterInForeignContent(p, token) {\n    token.chars = unicode.REPLACEMENT_CHARACTER;\n    p._insertCharacters(token);\n}\n\nfunction characterInForeignContent(p, token) {\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\n\nfunction startTagInForeignContent(p, token) {\n    if (foreignContent.causesExit(token) && !p.fragmentContext) {\n        while (\n            p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML &&\n            !p._isIntegrationPoint(p.openElements.current)\n        ) {\n            p.openElements.pop();\n        }\n\n        p._processToken(token);\n    } else {\n        const current = p._getAdjustedCurrentElement();\n        const currentNs = p.treeAdapter.getNamespaceURI(current);\n\n        if (currentNs === NS.MATHML) {\n            foreignContent.adjustTokenMathMLAttrs(token);\n        } else if (currentNs === NS.SVG) {\n            foreignContent.adjustTokenSVGTagName(token);\n            foreignContent.adjustTokenSVGAttrs(token);\n        }\n\n        foreignContent.adjustTokenXMLAttrs(token);\n\n        if (token.selfClosing) {\n            p._appendElement(token, currentNs);\n        } else {\n            p._insertElement(token, currentNs);\n        }\n\n        token.ackSelfClosing = true;\n    }\n}\n\nfunction endTagInForeignContent(p, token) {\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n\n        if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n            p._processToken(token);\n            break;\n        }\n\n        if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\n            p.openElements.popUntilElementPopped(element);\n            break;\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}